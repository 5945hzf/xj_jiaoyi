<!--账户 资金 概览-->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" CONTENT="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="format-detection" content="telephone=no" />
    <title>新疆化学品经营服务平台</title>
    <link rel="stylesheet" type="text/css" href="../css/index.css"/>
    <style type="text/css">
         .btn{width: 139px;height: 42px;line-height:42px;background-color: #007aff;color: white;text-align: center;border-radius: 5px;margin-left: 14px;}
         html,body{ width: 986px;background-color: white; min-width: 986px;}
         .container{width: 986px;height: 1418px;overflow: hidden;border: 1px solid #f1f1f1;}
         .container>.title{height: 50px;line-height: 50px;padding-left: 18px;font-size: 16px;border-bottom: 1px solid #f1f1f1;}
         .head{overflow: hidden;padding: 33px 0;border-bottom: 1px solid #f1f1f1;}
         .head>.left1{overflow: hidden;margin-left: 34px;margin-right: 25px;}
         .head>.left1>img{float:left;width: 160px;height: 104px;}
         .head>.right1{font-size: 14px;}
         .head>.right1>.top1{margin-bottom: 8px;}
         .head>.right2{margin-right: 21px;font-size: 14px;}
         .head>.right2>.btns{margin-top: 42px;}
         .fast{border-bottom: 1px solid #f1f1f1;padding-left:40px;height: 35px;line-height: 35px;font-size: 14px; }
         .orderList{padding: 19px 42px ;border-bottom: 1px solid #f1f1f1;overflow: hidden;}
         .orderList>div{height: 15px;font-size: 14px;}
         .orderList>.row{width: 0;border-left: 2px solid #f1f1f1;margin: 2px 20px;}
          /*td,th{padding-left: 49px;}*/
         table div,table td{text-align: center;}
         table tr{border-bottom: 1px solid #f1f1f1;height: 60px;}
         table tr td{overflow: hidden; vertical-align: middle;}
         table tr td a{color: #007aff;}
         .user div{
         	text-align: left;
         }

         .dai_pay_buy_order, .dai_pay_duizhang_order, .dai_ok_duizhang_order {
            cursor: pointer;
         }

         td.user div {
            text-align: center;
        }
    </style>
</head>
<body>


<div class="container">
    <div class="title">资金账户概览</div>
    <div class="head">
        <div class="left1 Lf"><img class="company_logo" src="../img/list_logo.png" alt=""></div>
        <div class="right1 Lf">
            <div class="top1 companyName">企业名称： </div>
            <div class="top1 cashBalance">现金余额： </div>
            <div class="top1 zhuce_time">注册时间： </div>
        </div>
        <div class="right2" style="float: right">
            <div><a href="moneyMange.html" class="Rt" style="color: #007aff;">账户管理</a></div>
            <div class="btns">
                <div class="btn Lf tixian exist_qx" data-exist="70" style="cursor: pointer;">提现</div>
                <div class="btn Lf chongzhi exist_qx" data-exist="71" style="background-color: #ff9c5a;cursor: pointer;"><a href="##" class="Rt" style="color: white;width: 100%;height: 100%;display: block;text-align: center;">充值</a></div>
            </div>
        </div>
    </div>
    <div class="fast"><a href="##">快速入口</a></div>
    <div class="orderList">
        <div class="Lf dai_pay_buy_order">待支付采购订单（<i style="color: #7dabff;">0</i>）</div>
        <div class="row Lf"></div>
        <div class="Lf dai_pay_duizhang_order">待支付兑账订单（<i style="color: #7dabff;">0</i>）</div>
        <div class="row Lf"></div>
        <div class="Lf dai_ok_duizhang_order">待确定兑账订单（<i style="color: #7dabff;">0</i>）</div>
        <div class="row Lf"></div>
        <div class="Lf downWd"><a href="##">账单下载</a></div>
    </div>

    <div style="padding:45px 0 15px 40px;border-bottom: 1px solid #f1f1f1;">最近账务明细</div>

    <table border="1"  width="985px" align="center" style="font-size: 12px;">
        <thead>
            <tr style="height: 35px;line-height: 35px;background-color: #fdfdfd;">
                <th>时间</th>
                <th style="width: 180px;">流水号 | 商户订单号</th>
                <th>类型</th>
                <th style="width: 252px;">交易对方</th>
                <th>收入/支出(元)</th>
                <th>余额(元)</th>
                <th style="width: 69px;">详情</th>
            </tr>
        </thead>
        <tbody class="myTbody">

        </tbody>


    </table>
    <div class="Rt" style="color: #007aff;font-size: 12px;margin: 13px 20px 0 0">
        <a href="##" class="exist_qx" data-exist="69" onclick="updateLeftManage('./moneyDetail.html',2)">查看所有账务信息</a>
    </div>
    <!-- 分页 -->
    <!-- <div class=" pageCont" style="text-align: center;margin-top: 20px;">
        <ul class="pagination" id="page1"></ul>
        <div class="pageJump">
            <span class="allPageN">1/200</span>
            <span style="margin-left: 10px;">共<span class="allPageSize">200</span>页，</span>
            <span>到第</span>
            <input class="page_page" type="text"/>
            <span>页</span>
            <button type="button" class="button goPage">GO</button>
        </div>
    </div> -->
</div>




<script src="../js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/common.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/pager.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">

    $('.chongzhi').click(function() {
        sessionStorage.setItem('flag', '1');
        window.location.href = 'moneyMange.html';
    });


	function updateLeftManage(src,id) {
	    window.parent.$("#Iframe").attr("src",src);
	//    window.parent.$("#Iframe").attr("height",src);
	    if(id==1){
	        window.parent.$(".manageItem").removeClass("active1");
	        window.parent.$("#moneyMange").addClass("active1");
	    }else if(id==2){
	        window.parent.$(".manageItem").removeClass("active1");
	        window.parent.$("#moneyDetail").addClass("active1");
	    }
    }

    //下载账单
    // $(document).on('click', '.downWd a', function () {
    //     // excel('');
    //     $(this).attr('download', pubIP + "financialApi/downExcel?token="+token+"&timeSlot=")
    //     $(this).attr('href', pubIP + "financialApi/downExcel?token="+token+"&timeSlot=");

    // });


    //下载账单
    $('.downWd a').attr('download', pubIP + "financialApi/downExcel?token="+token+"&currentPage=1&moneyFlow=&tranType=&orderId=&startTime=&endTime=&timeSlot=");

    $('.downWd a').attr('href', pubIP + "financialApi/downExcel?token="+token+"&currentPage=1&moneyFlow=&tranType=&orderId=&startTime=&endTime=&timeSlot=");

    //资金账户信息加余额
    $.ajax({
        type:"get",
        headers: {
            Accept: "application/json; charset=utf-8",
            token: token
        },
        url: pubIP+"financialApi/getBalanceAndCompany",//v1.0
        cache:false,
        data:{
        },
        dataType: "json",
        success: function(response){
            console.log(response);
            console.log("+++++++++++++");
            var data = response.data;
            var zc_time = new Date(data.authTime).Format("yyyy-MM-dd");
            if(response.code == 1){
                $('.cashBalance').text('现金余额： '+ response.data2 +'元');
                $('.companyName').text('企业名称： '+ data.companyName );
                $('.zhuce_time').text('注册时间： '+ zc_time);
                $('.company_logo').attr("src",data.storeImage);
            }
        }   
    });

	//资金账户快速入口统计---待支付采购订单
	$.ajax({ 
        type:"get",
        url:pubIP+"orderApi/countOrderMoneyAccount",//v1.0
        cache:false,
        dataType: "json",
        async:false,
        headers: {
        token: token
        },
        success: function(json){
        console.log(json.data);
            $('.orderList i').eq(0).text(json.data.stayPayOrder); //待支付采购订单
            $('.orderList i').eq(1).text(json.data.acOrderListPages); //待确认兑账订单
            $('.orderList i').eq(2).text(json.data.acOrderListPages2); //待支付兑账订单
            
        },
        error:function(xhr,statues,error){
            
        }
    });

    //待支付采购订单
    $('.dai_pay_buy_order').click(function() {
        window.sessionStorage.setItem('chushi_status', '1');

        window.location.href = 'myPurchase-order.html';
    });


    //待支付兑账订单
    $('.dai_pay_duizhang_order').click(function() {
        window.sessionStorage.setItem('chushi_status', '2');
        // window.sessionStorage.setItem('hzf_showPage', 'flag_dzdd');
        window.location.href = '../standingBook/accountCheck.html';
    });


    //待确认兑账订单
    $('.dai_ok_duizhang_order').click(function() {
        window.sessionStorage.setItem('chushi_status', '3');
        window.location.href = '../standingBook/accountCheck.html';
    });
    


    
    // 最近财务明细接口V1.0-中信银行接口-----------暂无数据
    $.ajax({
        type:"get",
        headers: {
            Accept: "application/json; charset=utf-8",
            token: token
        },
        url: pubIP+"financialApi/getFinancialLimitSize",
        cache:false,
        data:{size: 5},
        dataType: "json",
        success: function(response){
            console.log('最近财务明细', response);
            if(response.code == 1){
                if(response.data && response.data.length>0){
                    var list = response.data;
                    var str = '';
                    $.each(list,function(idx,item){
                        // var dates =  new Date(item.TRANDATE).Format("yyyy-MM-dd");
                        // var times =  new Date(item.TRANTIME).Format("hh-mm-ss");
                        str+='<tr>'
                        str+='<td>'
                        str+='<div>'+item.TRANDATE+'</div>'
                        str+='<div>'+item.TRANTIME+'</div>'
                        str+='</td>'
                        str+='<td>'
                        str+='<div>流水号：'+item.HOSTFLW+'</div>'
                        str+='<div>订单号：'+item.HOSTSEQ+'</div>'
                        str+='</td>'
                        if(item.TRANTYPE==15){
                            str+='<td style="margin-top: 27px;">现汇交易</td>'
                        }else if(item.TRANTYPE==23 && item.CDFG=="D"){
                            str+='<td style="margin-top: 27px;">提现</td>'
                        } else if(item.TRANTYPE==23 && item.CDFG=="C"){
                            str+='<td style="margin-top: 27px;">充值</td>'
                        } else if(item.TRANTYPE==11 && item.CDFG=="C"){
                            str+='<td style="margin-top: 27px;">充值</td>'
                        }else {
                            str+='<td style="margin-top: 27px;"></td>'
                        }
                        str+='<td class="user">'
                        str+='<div>账户名：'+item.OPPACCNAME+'</div>'
                        str+='<div>账户号：'+item.OPPACCNO+'</div>'
                        str+='</td>'
                        if(item.CDFG=="D"){
                            str+='<td>-'+item.TRANAMT+'</td>'
                        }else if(item.CDFG=="C"){
                            str+='<td>+'+item.TRANAMT+'</td>'
                        }
                        str+='<td>'+item.ACCBAL+'</td>'
                        // str+='<td><a href="./mySale-orderDetailStatus.html">查看</a></td>'
                        // str+='</tr>'
                        if (item.TRANTYPE == 11 || item.TRANTYPE == 23) {
                            str+='<td><a style="color: #333; cursor:default; " href="##">查看</a></td>'
                        } else {

                            str+='<td><a class="exist_qx" data-exist="69" href="./mySale-orderDetailStatus.html?userType='+item.type+'&id='+item.HOSTSEQ+'">查看</a></td>'
                        }
                        
                        str+='</tr>'
                        
                    })
                    $(".myTbody").html(str);

                    yiyou_quanxian(userId);
                }
            }
        }
    });

//    点击提现

$(".tixian").unbind().bind('click',function () {
    window.parent.$(".modelBox35 .tiXianMoney").val("");
    window.parent.$(".modelBox35 .payPassWord").val("");
    window.parent.$(".modelBox35 .SMScode").val("");
    window.parent.$("#sureTiXian").attr("data-isok","0");
    window.parent.$("#sureTiXian").attr("data-isok1","0");
    window.parent.$("#sureTiXian").attr("data-isok2","0");
    window.parent. $("#sureTiXian").css("backgroundColor","#c2ccd1");

    window.parent.$(".modelBox35").show();
    getPhone();
    //    获取余额
    $.ajax({
        type: "post",
        headers: {
            Accept: "application/json; charset=utf-8",
            token: token
        },
        url: pubIP + "payment/accountBalance",//v1.0
        cache: false,
        data: {},
        dataType: "json",
        success: function (response) {
            window.parent.$(".modelBox35 .moneyYuE").text(response.data)

        }
    });
})
    //获取手机号
    function getPhone(){
        $.ajax({
            url: pubIP + 'user/getUserInfoByToken', /*v1.0*/
            type: 'post',
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            cache: false,
            ansyc: true,
            dataType: 'json',
            data: {},
            success: function (data) {
                console.log(data);
                if (data.code == 1) {
                    window.parent.$(".modelBox35 .phone").val(data.financePhoneNumber);
                    window.parent.$(".modelBox35 .getSMSCode").unbind();
                    window.parent.$(".modelBox35 .getSMSCode").click(function () {
                        if($(this).attr("disabled")=="disabled"){
                            return;
                        }
                        getSCode(data.financePhoneNumber);
                    })
                } else {
                    return;
                }
            },
            error: function (err) {
                console.log(err);
            }
        })
    }
    //获短信取验证码
    function getSCode(phone) {
        $.ajax({
            url: pubIP + 'user/getMessageCode', /*v1.0*/
            type: 'post',
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            cache: false,
            ansyc: true,
            dataType: 'json',
            data: {
                mobile: phone,
                type: 3 //3是错误的，以后需要修改------------- 
            },
            success: function (data) {
                if (data.code == 1) {
                    //alert("发送验证码成功");
//                    $(".modelBox34 .SMScode").removeAttr("disabled");
                    var time=60;
                    window.parent.$(".modelBox35 .getSMSCode").attr("disabled","disabled");
                    window.parent.$(".modelBox35 .getSMSCode").css("background-color","#ddd");
                    var timer=setInterval(function () {
                        time--;
                        window.parent.$(".modelBox35 .getSMSCode").text(""+time+"秒")
                        if(time==0){
                            clearInterval(timer);
                            window.parent.$(".modelBox35 .getSMSCode").removeAttr("disabled");
                            window.parent.$(".modelBox35 .getSMSCode").css("background-color","#3582F8");
                            window.parent.$(".modelBox35 .getSMSCode").text("获取验证码")
                        }
                    },1000);

                } else {
                    alert(data.msg);
                    return;
                }
            },
            error: function (err) {
                console.log(err);
            }
        })
    }

    //确认提现
    // window.parent.$("#sureTiXian").unbind();
    window.parent.$("#sureTiXian").unbind().bind('click',function () {
        if($(this).attr("data-isok")==0){
            return;
        }
        $.ajax({
            type:"post",
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            url: pubIP+"payment/cashOut",//v1.0
            cache:false,
            data:{
                payPassword:window.parent.$(".modelBox35 .payPassWord").val(),
                amount:window.parent.$(".modelBox35 .tiXianMoney").val()
            },
            success: function(res){
                if(res.code == 1){
                    window.parent.$(".modelBox35").hide();//支付成功
                    alert(res.msg);
                }else{
                    alert(res.msg);
                }
            },
            error: function(err){
                console.log(err);
            }
        });
    })
</script>
</body>
</html>
