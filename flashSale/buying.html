<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
	    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta http-equiv="Cache-Control" CONTENT="no-cache">
	    <meta http-equiv="Pragma" content="no-cache">
	    <meta name="format-detection" content="telephone=no" />
		<title adct="抢购">新疆化学品经营服务平台</title>
		<link rel="stylesheet" type="text/css" href="../css/swiper.min.css"/>
		<link rel="stylesheet" type="text/css" href="../css/mCustomScrollbar.css"/>
		<link rel="stylesheet" type="text/css" href="../css/index.css"/>
		<link rel="stylesheet" type="text/css" href="../css/home.css"/>
		<script src="../js/header.js" type="text/javascript" charset="utf-8"></script>
		<link rel="stylesheet" type="text/css" href="../css/buying.css"/>
	</head>
	<body>
		<!--抢购-->
		<div class="maxWidth bannerBox">
			<div class="swiper-container">
			    <div class="swiper-wrapper">
			        <div class="swiper-slide"></div>
			        <div class="swiper-slide"></div>
			        <div class="swiper-slide"></div>
			    </div>
			    <!-- 如果需要分页器 -->
   			 	<div class="swiper-pagination"></div>
			</div>
			<div class="mianCont leftTabBoxout">
				
			</div>
		</div>
		
		<div class="buyTab" id="qianggou_title">
			
		</div>
		<div class="buyIngObj">
			<!-- <div class="now">
				<div class="buyIngSt"></div>
				<div class="objHeadImg  fl"></div>
				<div class="fl">
					<div class="buyObjTit"><span class="tit">中泰PVCXXXXXXXXX</span> <span class="gg">纯度：98%  型号：工业级</span></div>
					<div class="priceBox">
						<div class="fl">
							<div class="priceDv">
								<span class="buyPrice">
									￥<span class="priceNum">13600.00</span> 元/kg
								</span> 
								<span class="oldPrice">¥ 17.8 元／kg</span>
							</div>
							<p style="max-height: 14px;line-height: 14px;margin-bottom: 22px;">抢购进度：<span class="pgBg"> <span class="Progress"></span> </span></p>
							<div style="overflow: hidden;">
								<span class="fl">起定量：10吨</span>
								<span class="fr">抢购量：1000吨</span>
							</div>
						</div>
						<div class="fr lastTime">
							<span class="ltTIT">距离结束：</span>
							<p class="lasrTimeNum"><span>00</span>天<span>24</span>时<span>09</span>分<span>56</span>秒</p>
						</div>
					</div>
					<div class="fr buyIngBox">
						<span>已抢购 <span>0.9</span>吨</span>
						<button><a href="buyingDetails.html">立即抢购</a></button>
					</div>
				</div>
			</div>
			<div class="begin">
				<div class="buyIngSt"></div>
				<div class="objHeadImg  fl"></div>
				<div class="fl">
					<div class="buyObjTit"><span class="tit">中泰PVCXXXXXXXXX</span> <span class="gg">纯度：98%  型号：工业级</span></div>
					<div class="priceBox">
						<div class="fl">
							<div class="priceDv">
								<span class="buyPrice">
									￥<span class="priceNum">13600.00</span> 元/kg
								</span> 
								<span class="oldPrice">¥ 17.8 元／kg</span>
							</div>
							<p style="max-height: 14px;line-height: 14px;margin-bottom: 22px;">抢购进度：<span class="pgBg"> <span class="Progress"></span> </span></p>
							<div style="overflow: hidden;">
								<span class="fl">起定量：10吨</span>
								<span class="fr">抢购量：1000吨</span>
							</div>
						</div>
						<div class="fr lastTime">
							<span class="ltTIT">距离结束：</span>
							<p class="lasrTimeNum"><span>00</span>天<span>24</span>时<span>09</span>分<span>56</span>秒</p>
						</div>
					</div>
					<div class="fr buyIngBox">
						<span>已抢购 <span>0.9</span>吨</span>
						<button><a href="##">立即抢购</a></button>
					</div>
				</div>
			</div>
			<div class="finish">
				<div class="buyIngSt"></div>
				<div class="objHeadImg  fl"></div>
				<div class="fl">
					<div class="buyObjTit"><span class="tit">中泰PVCXXXXXXXXX</span> <span class="gg">纯度：98%  型号：工业级</span></div>
					<div class="priceBox">
						<div class="fl">
							<div class="priceDv">
								<span class="buyPrice">
									￥<span class="priceNum">13600.00</span> 元/kg
								</span> 
								<span class="oldPrice">¥ 17.8 元／kg</span>
							</div>
							<p style="max-height: 14px;line-height: 14px;margin-bottom: 22px;">抢购进度：<span class="pgBg"> <span class="Progress"></span> </span></p>
							<div style="overflow: hidden;">
								<span class="fl">起定量：10吨</span>
								<span class="fr">抢购量：1000吨</span>
							</div>
						</div>
						<div class="fr lastTime">
							<span class="ltTIT">距离结束：</span>
							<p class="lasrTimeNum"><span>00</span>天<span>24</span>时<span>09</span>分<span>56</span>秒</p>
						</div>
					</div>
					<div class="fr buyIngBox">
						<span>已抢购 <span>0.9</span>吨</span>
						<button><a href="##">立即抢购</a></button>
					</div>
				</div>
			</div> -->
		</div>
		
		<div class="mianCont" style="text-align: center;margin-top: 20px;">
		    <ul class="pagination" id="page1"></ul>
		    <div class="pageJump">
		    	 	<span class="allPageN">1/200</span>
		    	 	<span style="margin-left: 10px;">共<span class="total">200</span>页，</span>
		        <span>到第</span>
		        <input type="text" style="text-align: center;"/>
		        <span>页</span>
		        <button type="button" class="button">GO</button>
		    </div>
		</div>
		<script src="../js/footer.js" type="text/javascript" charset="utf-8"></script>
		<div class="fxd">
			<a href="##"><img src="../img/indexKefu.png" style="margin-top: 9px;"/> </a>
			<a href="##" id="showCd">
				<img src="../img/indexEcode.png"/> 
				<div class="showCode">
					<img src="../img/erwCode.png" />
				</div>
			</a>
			<a href="##" id="tousu"><img src="../img/indedxBi.png"/> </a>
			<a href="##" id="gotop"><img src="../img/indexDing.png"/> </a>
		</div>
		<div class="tsBg"></div>
		<div class="tsBox">
			<img src="../img/breadcrumbCloseIcon.png" id="colseAlert"/>
			<p>投诉建议</p>
			<div>
				<span>资讯类别</span>
				<select name="">
					<option value="建议">建议</option>
					<option value="投诉">投诉</option>
				</select>
			</div>
			<div>
				<span>联系人电话</span> <input type="text" placeholder="请输入手机号码"/>
			</div>
			<div>
				<span>联系人 </span><input type="text" placeholder="请输入联系人"/>
			</div>
			<div style="height: auto;">
				<span>问题描述 </span><textarea style="vertical-align: text-top;" placeholder="请输入您的问题"></textarea>
			</div>
			<div >
				<button>立即提交</button>
			</div>
		</div>
		
		<script src="../js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/index.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/swiper.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/common.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/template.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/pager.js" type="text/javascript" charset="utf-8"></script>

		<script type="text/javascript" >      

			var arr = [];
			var isFirst = true;

			// 请求分类标题
			title();
			function title() {
				$.ajax({
		        	type: "post",
		            url: pubIP + "acticityApi/findActivityGoodsList",
		            headers: {
		                token: token
		            },
		            cache: false,
		            async:false,
		            data: {
		            	type: 1,
		            	pageNum: 1,
		            	pageSize: 1
		            },
		            dataType: "json",
		            success: function(data){
						// console.log(data);
						var str1 = '<span data-activityid="">全  部</span>';

						for (var j = 0; j < data.activityList.length; j++) {

							str1 += '<span data-activityid="'+data.activityList[j].dbid+'">'+data.activityList[j].title+'</span>'

						}

						$('#qianggou_title').html(str1);

						$('#qianggou_title span').eq(0).addClass('act');
					},
					error: function (err) {
						console.log(err);
					}
				});
			}

			qianggouList(1, '');

			// 抢购列表
			function qianggouList(num, activityId) {
				$.ajax({
		        	type: "post",
		            url: pubIP + "acticityApi/findActivityGoodsList",
		            headers: {
		                token: token
		            },
		            cache: false,
		            async:false,
		            data: {
		            	type: 1,
		            	pageNum: num,
		            	pageSize: 1,
		            	activityId: activityId
		            },
		            dataType: "json",
		            success: function(data){
						console.log(data);

					
						activityId = activityId;
						// 分页
		                	if(data.code == '0'){
		                        $('.pageJump').hide();
		                        $('.shop_list_table tbody').html('');
		                        $('.notMsg').show();
		                        return false;
		                    } else if (data.code == '1') {

		                    	if (isFirst) {

				                    Page({
			                            num: data.count,
			                            elem: $('#page1'),
			                            callback: function(n) {
			                                num = n;
			                                qianggouList(n, activityId);
			                                console.log(activityId);
			                            }
			                        });

			                     
			                        
			                        $('.total').text(data.count);

			                        isFirst = false;
			                    }


			                    $('.allPageN').text(num+'/'+data.count);


			                    var str = '';

								for (var i = 0; i < data.data.length; i++) {
									
									data.data[i].endTime = new Date(data.data[i].endTime).Format("yyyy-MM-dd hh:mm:ss"); 

									if (data.data[i].productPic != null) {
										data.data[i].productPic = data.data[i].productPic.split(',')[0];
									}

									
									if (data.data[i].iStatus == '1') {
										str += '<div class="now">';
									} else if (data.data[i].iStatus == '2') {
										str += '<div class="begin">';
									} else if (data.data[i].iStatus == '3') {
										str += '<div class="finish">';
									} else {
										str += '<div>';
									}
									str += '<div class="buyIngSt"></div>'
											+'<div class="objHeadImg  fl" style="background: url('+data.data[i].productPic+') no-repeat; background-size: cover;"></div>'
											+'<div class="fl">'
												+'<div class="buyObjTit"><span class="tit">'+data.data[i].companyName+'</span> <span class="gg">纯度：'+data.data[i].productPurity+'% &nbsp;&nbsp;型号：'+data.data[i].productLevel+'</span></div>'
												+'<div class="priceBox">'
													+'<div class="fl">'
														+'<div class="priceDv">'
															+'<span class="buyPrice">'
																+'￥<span class="priceNum">'+data.data[i].unitPrice+'</span> 元/kg'
															+'</span>'
															+'<span class="oldPrice">¥ '+data.data[i].ounitPrice+'元／kg</span>'
														+'</div>'
														+'<p style="max-height: 14px;line-height: 14px;margin-bottom: 22px;">抢购进度：<span class="pgBg"> <span class="Progress" style="width:'+data.data[i].rate+'"></span> </span></p>'
														+'<div style="overflow: hidden;">'
															+'<span class="fl">起定量：'+data.data[i].minAmount+'吨</span>'
															+'<span class="fr">抢购量：'+data.data[i].sum+'吨</span>'
														+'</div>'
													+'</div>'
													+'<div class="fr lastTime">'
														+'<span class="ltTIT">距离结束：</span>'
														+'<p class="lasrTimeNum" id="distanceTime'+activityId+(num+1)+i+'"><span>00</span>天<span>24</span>时<span>09</span>分<span>56</span>秒</p>'
													+'</div>'
												+'</div>'
												+'<div class="fr buyIngBox">'
													+'<span>已抢购 <span>'+data.data[i].sales+'</span>吨</span>'
													+'<button><span class="buying_a" data-supplyId="'+data.data[i].supplyId+'" data-activityid="'+data.data[i].activityId+'" data-createCompany="'+data.data[i].createCompany+'" data-rate="'+data.data[i].rate+'" data-iStatus="'+data.data[i].iStatus+'">立即抢购</span></button>'
												+'</div>'
											+'</div>'
										+'</div>';

								}

								$('.buyIngObj').html(str);

					           	for (var i = 0; i < data.data.length; i++) {
									
									var time2 = new Date(data.data[i].endTime).Format("yyyy-MM-dd hh:mm:ss"); 

									distanceTime3("distanceTime"+activityId+(num+1)+i+"", time2, arr['timer'+i]);
								}

		                    }

						
						
		            },
		            error: function(err) {
		            	console.log(err);
		            }
		        });
			}


			// 立即抢购
			$(document).on('click', '.buying_a', function () {
				window.localStorage.setItem('objid', $(this).attr('data-supplyId'));
				window.localStorage.setItem('activityId', $(this).attr('data-supplyId'));
				window.localStorage.setItem('thisCompanyId', $(this).attr('data-createCompany'));
				window.localStorage.setItem('rate', $(this).attr('data-rate'));
				window.localStorage.setItem('iStatus', $(this).attr('data-iStatus'));

				window.location.href="buyingDetails.html";
			});



			// 点击分类
			$(document).on('click', '#qianggou_title span', function() {
				$('#qianggou_title span').removeClass('act');
				$(this).addClass('act');
				isFirst = true;
				qianggouList(1, $(this).attr('data-activityid'));
				
				
			});



			function distanceTime3(id, deadtime, i) {  

				// debugger;
                var endtime = new Date(deadtime); //结束时间  
                var nowtime = new Date(); //当前时间  
                var lefttime = parseInt(((endtime.getTime() - nowtime.getTime()) / 1000));  
                //parseInt可以只取整数部分，返回一个整数  
                var d = parseInt(lefttime / (24 * 60 * 60));  
                var h = parseInt(lefttime / (60 * 60) % 24);  
                var m = parseInt((lefttime / 60) % 60);  
                var s = lefttime % 60; 
                if (d < 0) {
                	d = '0' + d;
                }

                if (h < 0) {
                	h = '0' + h;
                }

                if (m < 0) {
                	m = '0' + m;
                }

                if (s < 0) {
                	s = '0' + s;
                }

                if (document.getElementById(id) == null) {
                	return false;
                }

                document.getElementById(id).innerHTML = '<span>'+d+'</span>天'
        				+'<span>'+h+'</span>时'
        				+'<span>'+m+'</span>分'
        				+'<span>'+s+'</span>秒'
                	// d + '天' + h + '时' + m + '分' + s + '秒';  
                if(lefttime <= 0) {  
                    document.getElementById(id).innerHTML = '<span>00</span>天'
        				+'<span>00</span>时'
        				+'<span>00</span>分'
        				+'<span>00</span>秒';  
                    clearTimeout(i);  
                }  
                i = setTimeout("distanceTime3('" + id + "','" + deadtime + "')", 1000); //timer为全局变量  
            }





			$('.tsBg').height($(window).height());
			$('.saleObjBox>div:nth-child(3n)').css('margin-right','0');
			var mySwiper = new Swiper ('.swiper-container', {
			    loop: true,
			    autoplay: 5000,
			    pagination: '.swiper-pagination',
			    paginationClickable: true
			  })        
			$('#colseAlert').click(function(){
				$('.tsBg').hide();
				$('.tsBox').hide();
			})
			$('#tousu').click(function(){
				$('.tsBg').show();
				$('.tsBox').fadeIn();
			})
	       
	        // $(document).on('click','.saleObjBox>div>button',function(){
	       	// 	localStorage.setItem('objid',$(this).attr('objid'));
	       	// 	localStorage.setItem('thisCompanyId',$(this).attr('thisCmpId'));
	       	// 	location.href = '../obj/objDetails.html';
	        // })
	       
	        //拦截链接
	        $(document).on('click','a',function(e){
	       		e.preventDefault();
	       		var isOld = localStorage.getItem('isOld');
	       		if(isOld != '2'){
	       			var ttxt = $.trim($(this).text());
	       			console.log(ttxt);
	       			if(ttxt == '用户中心' || ttxt == '发布商品' || ttxt == '发布采购' || ttxt == '立即报价' || ttxt == '路线查询' || ttxt == '立即申请'){
	       				if(isOld == '1'){
	       					$('#effect .contTitle span').text('您尚未登录');
							missedLogin() ;
	       				}else if(isOld == '0'){
	       					missedLogin() ;
	       				}else if(isOld == '-1'){
	       					$('#effect .contTitle span').text('您尚未认证');
	       					$('#effect .contTitle i').text('认证');
	       					$('#popLogin').text('认证');
							missedLogin() ;
	       				}else if(isOld == '-2'){
	       					$('#effect .contTitle span').text('您的认证正在审核中');
	       					$('#effect .contTitle i').text('等待审核通过').css('color','#000');
	       					$('#popLogin').hide();
							missedLogin() ;
	       				}
	       			}else{
	       				window.location.href = this.href;
	       			}
	       		}else{
	       			window.location.href = this.href;
	       		}
	        })
	  </script>
	</body>
</html>
