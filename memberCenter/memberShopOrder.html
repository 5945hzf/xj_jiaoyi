<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" CONTENT="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="format-detection" content="telephone=no" />
	<title adct1="1">新疆化学品经营服务平台</title>
	<link rel="stylesheet" type="text/css" href="../css/index.css"/>
	<link rel="stylesheet" type="text/css" href="../css/home.css"/>
	<link rel="stylesheet" type="text/css" href="../css/common.css"/>
	<link rel="stylesheet" type="text/css" href="../css/memberCenter/memberShopOrder.css"/>
	<style>

		.shop_order ul li.current_order span{
		    color: #5590F6;
		    position: relative;
		}
		.shop_order ul li.current_order span::before{
		    position: absolute;
		    left: 0;
		    bottom: 0;
		    content: "";
		    width: 100%;
		    height: 4px;
		    background: #5590F6;
		    transform: scaleX(1);
		    transform-origin: 0 0;
		}
		.shop_order li span {
		    position: relative;
		    display: inline-block;
		    height: 50px;
		    cursor: pointer;
		}
		.shop_order li span::before{
		    position: absolute;
		    left: 0;
		    bottom: 0;
		    content: "";
		    width: 100%;
		    height: 4px;
		    background: #5590F6;
		    transform: scaleX(0);
		    transform-origin: 100% 0;
		    transition: transform 0.5s;
		}
		.shop_order li span:hover::before{
		    transform: scaleX(1);
		    transform-origin: 0 0;
		}

		.fs	li:nth-child(2) {
			white-space: nowrap; text-overflow: ellipsis; display: inline-block; overflow: hidden;height: 100%; line-height: 79px;
		}

		.selectPub {
			width: 145px;
		}

		.fs {
			padding-bottom: 0px;
		}
	</style>
</head>
<body>
	
	<!-- 会员商品订单 -->
	<div class="memberShopOrder">
		<div class="memberShopOrderTitle">
			<span>会员商品订单</span>
			<div class="fr sousuo_order clearfix">
				<!-- <input class="fl search_input" type="text" placeholder="按订单编号/商品名称查询"><img class="fl search exist_qx" data-exist="67" src="../img/mp_search.png" alt=""> -->
				<input class="fl search_input" type="text" placeholder="按订单编号/商品名称查询"><img class="fl search" src="../img/mp_search.png" alt="">
			</div>
		</div>
		<div class="shop_order">
			<ul class="clearfix">
				<li class="current_order"><span data-state="">全部订单</span></li>
				<li><span data-state="1">待发货</span></li>
				<li><span data-state="2">待支付</span></li>
				<li><span data-state="3">待确认收货</span></li>
				<li><span data-state="4">已完成</span></li>
			</ul>
		</div>
		<div class="order_title">
			<ul class="clearfix">
				<li style="width: 230px;">
					<div class="selectPub selectPub_hzf1" data-selectedindex="1" style="float: left;margin-top: 3px;">
		                <span>近三个月的订单</span>
		                <img src="../img/prl-select.jpg" alt="">
		                <ul class="my_select_hzf">
		                    <li data-index="1">近三个月的订单</li>
		                    <li data-index="2">近一年的订单</li>
		                    <li data-index="3">历史交易的订单</li>
		                </ul>
		            </div>
				</li>
				<li style="width: 112px;">规格</li>
				<li style="width: 160px;">数量</li>
				<li style="width: 170px;">金额</li>
				<li style="width: 145px;">全部状态</li>
				<li>操作</li>
			</ul>
		</div>
		<div class="order_list">
			<ul class="order_list_ul">
				<!-- <li>
					<div class="shop_num_time clearfix">
						<span class="shop_num fl">采购需求编号：3001707271606350063</span>
						<span class="shop_time fr">订单日期：2017-07-27  16: 06: 30</span>
					</div>
					<div class="fs">
						<ul class="clearfix">
							<li style="width: 50px;"><span class="order_num">1</span></li>
							<li style="font-size: 16px; width: 153px;">迭氮（化）铅[含水或水加乙醇≥20%] </li>
							<li style="width: 124px; padding-left: 50px;">红色</li>
							<li style="width: 110px;"><span class="dun_num">2.00</span>吨</li>
							<li style="width: 162px; padding-left: 65px;">
								<p>积分：<span class="dun_num">1000</span></p>
								<p>现金：<span class="xinjin_num">￥20000000</span></p>
							</li>
							<li style="width: 110px; padding-right: 8px;">待支付</li>
							<li>
								<span class="wei_pay"><a href="##">立即支付</a></span>
							</li>
						</ul>
						<ul class="clearfix">
							<li style="width: 50px;"><span class="order_num">1</span></li>
							<li style="font-size: 16px; width: 153px;">迭氮（化）铅[含水或水加乙醇≥20%] </li>
							<li style="width: 124px; padding-left: 50px;">红色</li>
							<li style="width: 110px;"><span class="dun_num">2.00</span>吨</li>
							<li style="width: 162px; padding-left: 65px;">
								<p>积分：<span class="dun_num">1000</span></p>
								<p>现金：<span class="xinjin_num">￥20000000</span></p>
							</li>
							<li style="width: 110px; padding-right: 8px;">待支付</li>
							<li>
								<span class="cancel_order"><a href="##">取消订单</a></span>
							</li>
						</ul>
						<ul class="clearfix">
							<li style="width: 50px;"><span class="order_num">1</span></li>
							<li style="font-size: 16px; width: 153px;">迭氮（化）铅[含水或水加乙醇≥20%] </li>
							<li style="width: 124px; padding-left: 50px;">红色</li>
							<li style="width: 110px;"><span class="dun_num">2.00</span>吨</li>
							<li style="width: 162px; padding-left: 65px;">
								<p>积分：<span class="dun_num">1000</span></p>
								<p>现金：<span class="xinjin_num">￥20000000</span></p>
							</li>
							<li style="width: 110px; padding-right: 8px;">待支付</li>
							<li>
								<span class="look_order"><a href="##">查看订单</a></span>
							</li>
						</ul>
					</div>
				</li> -->
			</ul>
		</div>
		<div class="mianCont pageCont" style="width:980px;text-align:center;overflow: hidden;height: auto;margin: 20px auto 20px;">
	        <ul class="pagination" id="page1"></ul>
	        <div class="pageJump">
	                    <span class="allPageN">1/1</span>
	                    <span>共<span class="total" style="margin-left: 0px;">1</span>页，</span>
	            <span>到第</span>
	            <input type="text" style="text-align: center; padding-left: 0px;"/>
	            <span>页</span>
	            <button type="button" class="button">GO</button>
	        </div>
	    </div>
	</div>


	<script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/common.js"></script>
	<script src="../js/pager.js" type="text/javascript" charset="utf-8"></script>
	<script>

		$('.my_select_hzf li').click(function() {
			isFirst = true;
			memberShopOrder(1, 10, '', $('.shop_order li.current_order span').attr('data-state'), $(this).attr('data-index'));

		});

		$('.shop_order li span').click(function(){
			$('.shop_order li').removeClass('current_order');
			$(this).parent().addClass('current_order');
			var state= $(this).attr('data-state');

			isFirst = true;
			memberShopOrder(1, 10, '', state, $('.selectPub_hzf1').attr('data-selectedindex'));

		});

		$('.search').click(function() {
			$('.selectPub_hzf1').attr('data-selectedindex', '0');
			$('.selectPub_hzf1 span').text('近三个月的订单');

			var input = $('.search_input').val();
			isFirst = true;
			memberShopOrder(1, 10, input, '', 1);
		});

		var isFirst = true;

		memberShopOrder(1, 10, '', '', 1);
		// 
		function memberShopOrder(num, size, searchName, state, timeLimit) {
			$.ajax({
				type:"post",
		        url:pubIP+"memberOrder/findOrderList",//v1.0
		        cache:false,
		        dataType: "json",
		        async:false,
		        headers: {
	                Accept: "application/json; charset=utf-8",
	                token: token
	            },
	            data: {
	            	pageNum: num,
	            	pageSize: size,
	            	searchName: searchName,
	            	state: state, //1 待发货 2 待支付 3 待确认收货 4 已完成
	            	timeLimit: timeLimit //1 近三个月 2 近一年 3 历史交易
	            },
		        success: function(data){
		        	console.log(data);
		        	
		        	if (data.code == 1) {
		        		if (data.pageInfo.list.length != 0) {

		        			$('#page1').show();
		        			$('.pageJump').show();

		        			var str = '';
		        			for (var i = 0; i < data.pageInfo.list.length; i++) {
		        				
		        				data.pageInfo.list[i].submitTime = new Date(data.pageInfo.list[i].submitTime).Format("yyyy-MM-dd hh:mm:ss");

		        				var status = '';
		        				if (data.pageInfo.list[i].status == 1) {
		        					status = '待发货'
		        				} else if (data.pageInfo.list[i].status == 2) {
		        					status = '待支付'
		        				} else  if (data.pageInfo.list[i].status == 3) {
		        					status = '待确认收货'
		        				} else  if (data.pageInfo.list[i].status == 4) {
		        					status = '已完成'
		        				} else  if (data.pageInfo.list[i].status == -1) {
		        					status = '已取消'
		        				}

		        				if (data.pageInfo.list[i].spec == null) {
		        					data.pageInfo.list[i].spec = '';
		        				}

		        				str += '<li>'
									+'<div class="shop_num_time clearfix">'
										+'<span class="shop_num fl">订单编号：'+data.pageInfo.list[i].orderId+'</span>'
										+'<span class="shop_time fr">订单日期：'+data.pageInfo.list[i].submitTime+'</span>'
									+'</div>'
									+'<div class="fs">'
										+'<ul class="clearfix">'
											+'<li style="width: 50px;"><span class="order_num">'+(i+1)+'</span></li>'
											+'<li style="font-size: 16px; width: 153px;" title="'+data.pageInfo.list[i].goodsName+'">'+data.pageInfo.list[i].goodsName+'</li>'
											+'<li style="width: 115px;">'+data.pageInfo.list[i].spec+'</li>'
											+'<li style="width: 110px; padding-right: 20px;"><span class="dun_num">'+data.pageInfo.list[i].goodsNum+'</span></li>'
											+'<li style="width: 163px; padding-left: 49px;">'
											if (data.pageInfo.list[i].goodsPayMethod == 1) { //现金

												if (Number(data.pageInfo.list[i].carriageCash) > 0) {
													str += '<p>现金：<span class="xinjin_num">￥'+(Number(data.pageInfo.list[i].cash) + Number(data.pageInfo.list[i].carriageCash))+'</span></p>'
												} else {
													str += '<p>现金：<span class="xinjin_num">￥'+data.pageInfo.list[i].cash+'</span></p>'
												}
												
												
											} else if (data.pageInfo.list[i].goodsPayMethod == 2) { //积分

												if (Number(data.pageInfo.list[i].carriageCash) > 0) {
													str += '<p>积分：<span class="dun_num">'+data.pageInfo.list[i].integral+'</span></p>'
														+'<p>现金：<span class="xinjin_num">￥'+data.pageInfo.list[i].carriageCash+'</span></p>'
												} else {
													str += '<p>积分：<span class="dun_num">'+data.pageInfo.list[i].integral+'</span></p>'
												}
												
												
												
											} else if (data.pageInfo.list[i].goodsPayMethod == 3) {
												
												if (Number(data.pageInfo.list[i].carriageCash) > 0) {

													str += '<p>积分：<span class="dun_num">'+data.pageInfo.list[i].integral+'</span></p>'
													+'<p>现金：<span class="xinjin_num">￥'+(Number(data.pageInfo.list[i].cash) + Number(data.pageInfo.list[i].carriageCash))+'</span></p>'

												} else {

													str += '<p>积分：<span class="dun_num">'+data.pageInfo.list[i].integral+'</span></p>'
													+'<p>现金：<span class="xinjin_num">￥'+data.pageInfo.list[i].cash+'</span></p>'
												}
												
											}
											
											str += '</li>'
											+'<li style="width: 110px; padding-right: 20px;">'+status+'</li>'
											+'<li style="padding-right: 13px;">'
												+'<span class="look_order exist_qx" data-exist="66"><a href="##" data-delivery="'+data.pageInfo.list[i].carriageCash+'" data-status="'+data.pageInfo.list[i].status+'" data-orderId="'+data.pageInfo.list[i].orderId+'">查看订单</a></span>'
											+'</li>'
										+'</ul>'
									+'</div>'
								+'</li>'
		        			}

		        			$('.order_list_ul').html(str);

		        			if (isFirst) {
                            
	                            Page({
	                                num: data.pageInfo.pages,
	                                elem: $('#page1'),
	                                callback: function(n) {
	                                    memberShopOrder(n, size, searchName, state, timeLimit);
	                                }
	                            });

	                            $('.total').text(data.pageInfo.pages);


	                            isFirst = false;
	                       }

	                        $('.allPageN').text(num+'/'+data.pageInfo.pages);
		        			

		        		} else {
		        			$('.order_list_ul').html('');
		        			$('#page1').hide();
		        			$('.pageJump').hide();
		        		}
		        	}

		        },
		        error: function(err) {
		        	console.log(err);
		        }
		    }); 
		}


        $(document).on('click', '.look_order a', function() {
        	sessionStorage.setItem('orderId', $(this).attr('data-orderId'));
        	sessionStorage.setItem('status', $(this).attr('data-status'));

        	sessionStorage.setItem('delivery_money', $(this).attr('data-delivery'));
        	
        	window.parent.location.href="../memberCenter/orderDetailWeiPay.html";
        });

	</script>
</body>
</html>