<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" CONTENT="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="format-detection" content="telephone=no" />
	<title>新疆化学品经营服务平台</title>
	<link rel="stylesheet" type="text/css" href="../css/index.css"/>
	<link rel="stylesheet" type="text/css" href="../css/home.css"/>
	<link rel="stylesheet" type="text/css" href="../css/common.css"/>
	<link rel="stylesheet" type="text/css" href="../css/memberCenter/personalGrowthValue.css"/>
</head>
<style>
	.gold_member {
		width: auto;
		padding: 0 3px;
	}

	.progress_width span {
		vertical-align: top;
		position: static;
	}

	.progress_width {
	    vertical-align: middle;
	}

	.qiandao {
		width: auto;
		padding: 0 4px;
	}

	.total {
		margin-left: 0px;
	}

	.table {
	    height: 888px;
	}

	.table_body {
		height: 750px;
	}
</style>
<body>
	
	<!-- 个人成长值 -->
	<div class="personalGrowthValue">
		<div class="personalGrowthValueTitle">
			<span>个人成长值</span>
			<div class="fr mp">
				<span class="clearfix disblock">
					<input type="text" class="date-input laydate-icon fl" placeholder="请选择日期" id="test1"><span class="data_search search1 fl">搜索</span>
				</span>
				<span class="clearfix disblock">
					<input type="text" placeholder="来源" class="search_input fl"><span class="data_search search fl">搜索</span>
				</span>
			</div>
		</div>
		<div class="personal_info clearfix">
			<div class="avatar_bg fl"><img src="" alt=""></div>
			<div class="fl mt32">
				<p>
					<span class="gongxian">贡献：<img src="../img/gongxian.png" alt=""><span class="gongxian_num">0</span>分</span>
					<span class="jifen">可用积分：<img src="../img/jifen.png" alt=""><span class="jifen_num">0</span>分</span>
				</p>
				<p>
					<span>等级：</span>
					<span class="progress_width"><span></span></span>
					<span class="cha">还差<span class="cha_num">6000</span>分升级</span>
				</p>
				<p>
					目前等级：<span class="gold_member">黄金会员</span>
				</p>
			</div>
		</div>
		<div class="table">
			<div class="table_title">
				<ul class="clearfix">
					<li>排序</li>
					<li>日期</li>
					<li>来源</li>
					<li>获得积分</li>
				</ul>
			</div>
			<div class="table_body">
				<!-- <ul class="clearfix">
					<li><span class="sort">1</span></li>
					<li>2018-01-02 10:02:30</li>
					<li><span class="qiandao">签到</span></li>
					<li><span class="jifen_list"><span style="color: #f66132;">100</span>分</span></li>
				</ul>
				<ul class="clearfix">
					<li><span class="sort">1</span></li>
					<li>2018-01-02 10:02:30</li>
					<li><span class="qiandao">签到</span></li>
					<li><span class="jifen_list"><span style="color: #f66132;">100</span>分</span></li>
				</ul>
				<ul class="clearfix">
					<li><span class="sort">1</span></li>
					<li>2018-01-02 10:02:30</li>
					<li><span class="qiandao">签到</span></li>
					<li><span class="jifen_list"><span style="color: #f66132;">100</span>分</span></li>
				</ul>
				<ul class="clearfix">
					<li><span class="sort">1</span></li>
					<li>2018-01-02 10:02:30</li>
					<li><span class="qiandao">签到</span></li>
					<li><span class="jifen_list"><span style="color: #f66132;">100</span>分</span></li>
				</ul>
				<ul class="clearfix">
					<li><span class="sort">1</span></li>
					<li>2018-01-02 10:02:30</li>
					<li><span class="qiandao">签到</span></li>
					<li><span class="jifen_list"><span style="color: #f66132;">100</span>分</span></li>
				</ul> -->
			</div>
			<div class="mianCont pageCont" style="width:980px;text-align:center;overflow: hidden;height: auto;">
		        <ul class="pagination" id="page1"></ul>
		        <div class="pageJump">
		                    <span class="allPageN">1/1</span>
		                    <span>共<span class="total">1</span>页，</span>
		            <span>到第</span>
		            <input type="text" style="text-align: center; padding-left: 0px;"/>
		            <span>页</span>
		            <button type="button" class="button">GO</button>
		        </div>
		    </div>
		</div>
	</div>

	<script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/common.js"></script>
    <script src="../account/laydate/laydate.js"></script> <!-- 改成你的路径 -->
    <script src="../js/pager.js" type="text/javascript" charset="utf-8"></script>
	<script>
		laydate({
		    elem: '#test1',
		    format: 'YYYY-MM-DD',
		    istime: false,
		    choose: function(dates){ //选择好日期的回调
		        
		    }   
		});

		//日期搜索
		$('.search').click(function() {
			isFirst = true;

			var test1 = $('#test1').val();
			var source = $('.search_input').val();
			personalGrowthValue(1, 15, test1, source);
		});

		//来源搜索
		$('.search1').click(function() {
			isFirst = true;

			var test1 = $('#test1').val();
			var source = $('.search_input').val();
			personalGrowthValue(1, 15, test1, source);
		});

		var isFirst = true;

		personalGrowthValue(1, 15, '', '');
		// 
		function personalGrowthValue(num, size, time, source) {
			$.ajax({
				type:"get",
		        url:pubIP+"member/getUserGrowhtInfo",//v1.0
		        cache:false,
		        dataType: "json",
		        async:false,
		        headers: {
	                Accept: "application/json; charset=utf-8",
	                token: token
	            },
	            data: {
	            	pageNum: num,
	            	pageSize: size,
	            	time: time,
	            	source: source,
	            	type: 0,
	            	integralType: ''
	            },
		        success: function(data){
		        	console.log(data);
		        	
		        	if (data.code == 1) {
		        		if (data.data.result.length != 0) {

		        			$('#page1').show();
		        			$('.pageJump').show();

		        			var str = '';
		        			for (var i = 0; i < data.data.result.length; i++) {
		        				
		        				data.data.result[i].time = new Date(data.data.result[i].time).Format("yyyy-MM-dd hh:mm");

		        				str += '<ul class="clearfix">'
									+'<li><span class="sort">'+(i+1)+'</span></li>'
									+'<li>'+data.data.result[i].time+'</li>'
									+'<li><span class="qiandao">'+data.data.result[i].source+'</span></li>'
									+'<li><span class="jifen_list"><span style="color: #f66132;">'+data.data.result[i].score+'</span>分</span></li>'
								+'</ul>'
		        			}

		        			$('.table_body').html(str);

		        			if (isFirst) {
                            
	                            Page({
	                                num: data.data.pages,
	                                elem: $('#page1'),
	                                callback: function(n) {
	                                    personalGrowthValue(n, size, time, source);
	                                }
	                            });

	                            $('.total').text(data.data.pages);


	                            isFirst = false;
	                       }

	                        $('.allPageN').text(num+'/'+data.data.pages);
		        			

		        		} else {
		        			$('.table_body').html('');
		        			$('#page1').hide();
		        			$('.pageJump').hide();
		        		}
		        	}

		        },
		        error: function(err) {
		        	console.log(err);
		        }
		    }); 
		} 

		$.ajax({
			type:"get",
	        url:pubIP+"member/findUserGrowthInfo",//v1.0
	        cache:false,
	        dataType: "json",
	        async:false,
	        headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
	        success: function(data){
	        	console.log(data);
	        	
	        	if (data.data) {
	        		if (data.data.storeImage != null) {
	        			// $('.avatar_bg img').attr('src', data.data.storeImage);
	        			$('.avatar_bg').css('background', 'url("'+data.data.storeImage+'") center center no-repeat');
	        		}

	        		$('.gongxian_num').text(data.data.memberIntegralCurrent == null ? 0 : data.data.memberIntegralCurrent);

	        		$('.jifen_num').text(data.data.memberIntegralUsable == null ? 0 : data.data.memberIntegralUsable);

	        		$('.gold_member').text(data.data.propertiesName);

	        		$('.cha_num').text(data.data.nextValue);

	        		
	        		if (data.data.ratio.indexOf('%') != -1) {
	        			data.data.ratio = data.data.ratio.split('%').join('');	
	        		}

	        		if (data.data.ratio == '100') {

	        			data.data.ratio = 0;
	        		} else {
	        			data.data.ratio = Number(100 - 20);
	        		}

	        		$('.progress_width span').css('width', data.data.ratio+'%');
	        		
	        	}

	        },
	        error: function(err) {
	        	console.log(err);
	        }
	    }); 

	</script>
</body>
</html>