<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" CONTENT="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="format-detection" content="telephone=no" />
	<title adct1="1">新疆化学品经营服务平台</title>
	<link rel="stylesheet" type="text/css" href="../css/index.css"/>
	<link rel="stylesheet" type="text/css" href="../css/home.css"/>
	<link rel="stylesheet" type="text/css" href="../css/common.css"/>
	<link rel="stylesheet" type="text/css" href="../css/shopManage/customerRelationship.css">
	<style>
		.person_relation_wang_title div {
		    width: 340px;
		}

		.person_relation_wang_title div input[type="text"] {
			width: 250px;
		}
		
		.person_relation_wang_title div.selectPub {
			width: 200px;
		}

		.person_relation_wang_title div.selectPub>ul {
			top: 35px;
			font-size: 14px;

		}
	</style>
</head>
<body>

	<!-- 客户关系管理 -->
	<div class="customerRelationship">
		<div class="customerRelationshipTitle">
			<span>客户关系网</span>
		</div>
		<div class="customerRelationship_wang">
			<div class="add_customer_relationship">添加客户关系</div>
			<div id="container" style="height: 782px; width: 984px;"></div>
		</div>
		<div class="person_relation_wang">
			<div class="person_relation_wang_title clearfix">
				<span>人工关系网</span>
				<div class="fr clearfix">
					<input type="text" class="str_up" placeholder="企业名称/企业类型/业务员">
					<span style="cursor:pointer;" class="search2">搜索</span>
				</div>
				<!-- <div class="fr clearfix" style="margin-right: 20px; width: 290px;">
					<input type="text" class="store_type" style="width: 200px;" placeholder="企业类型">
					<span style="cursor:pointer;" class="search1">搜索</span>
				</div> -->
				<div class="selectPub store_type fr" style="background: #fff;" data-selectedindex="">
                    <span style="color: #666; font-size: 14px; text-align: left;">企业类型</span>
                    <img src="../img/prl-select.jpg" alt="">
                    <ul>
                    	<li data-index="">全部</li>
                        <li data-index="0">厂家</li>
                        <li data-index="1">贸易商</li>
                        <li data-index="2">终端</li>
                    </ul>
                </div>
			</div>
			<div class="person_relation_list clearfix">
				<ul class="clearfix">
					<li class="person_relation_li1">排序</li>
					<li class="person_relation_li2">企业名称</li>
					<li class="person_relation_li3">企业类型</li>
					<li class="person_relation_li4">业务员</li>
					<li class="person_relation_li5">添加时间</li>
					<li class="person_relation_li6">操作</li>
				</ul>
				<ul class="cont_list">
					<!-- <li>
						<span class="person_num"><span>1</span></span>
						<span class="qiye_name">中泰化工</span>
						<span class="qiye_type">化工</span>
						<span class="yewuyuan">陈槐三</span>
						<span class="add_time">2018-02-25</span>
						<span class="operate">
							<a href="##" class="edit_btn">编辑</a>
							<a href="##" class="del_btn">删除</a>
						</span>
					</li>
					<li>
						<span class="person_num"><span>2</span></span>
						<span class="qiye_name">中泰化工</span>
						<span class="qiye_type">化工</span>
						<span class="yewuyuan">陈槐三</span>
						<span class="add_time">2018-02-25</span>
						<span class="operate">
							<a href="##" class="edit_btn">编辑</a>
							<a href="##" class="del_btn">删除</a>
						</span>
					</li>
					<li>
						<span class="person_num"><span>3</span></span>
						<span class="qiye_name">中泰化工</span>
						<span class="qiye_type">化工</span>
						<span class="yewuyuan">陈槐三</span>
						<span class="add_time">2018-02-25</span>
						<span class="operate">
							<a href="##" class="edit_btn">编辑</a>
							<a href="##" class="del_btn">删除</a>
						</span>
					</li> -->
				</ul>
			</div>
			<div class="mianCont pageCont" style="width:980px;text-align:center;overflow: hidden;height: auto;margin: 20px auto">
		        <ul class="pagination" id="page1"></ul>
		        <div class="pageJump">
		                    <span class="allPageN">1/1</span>
		                    <span>共<span class="total">1</span>页，</span>
		            <span>到第</span>
		            <input type="text" style="text-align: center; padding-left: 0px;"/>
		            <span>页</span>
		            <button type="button" class="button">GO</button>
		        </div>
		    </div>
		</div>
	</div>

	<script src="../js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../js/common.js" type="text/javascript" charset="utf-8"></script>
	<script src="../js/pager.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script>

	<script>

		$(document).on('click', '.add_customer_relationship', function() {

			window.parent.$('#addCustomerRelationship .customer_relation_ship_btn').attr('data-customerId', '');

			window.parent.$('#addCustomerRelationship .modeltitle span').text('添加客户关系');

			window.parent.$('#addCustomerRelationship .qiye_name_input').val('');
			window.parent.$('#addCustomerRelationship .qiye_name_kuang .ts_div').text('');

			window.parent.$('#addCustomerRelationship .qiye_name_input').attr('disabled', false);

			//企业类型
			window.parent.$('#addCustomerRelationship .qiye_type_input').val('');

			window.parent.$('#addCustomerRelationship .qiye_type_input').attr('data-selectIndex', '');

			window.parent.$('#addCustomerRelationship .qiye_type_input').attr('disabled', true);


			//上下游
			window.parent.$('#addCustomerRelationship .up_down_relationship_input span').text('上游');

			window.parent.$('#addCustomerRelationship .up_down_relationship_input').attr('data-selectedindex', '1');
			
			window.parent.addCustomerRelationship();

		});

		window.parent.$('#addCustomerRelationship .qiye_name_input').blur(function() {
			
			if ($(this).val() == '') {
				$(this).parent().find('.ts_div').text('企业名称不能为空').css('visibility', 'visible');


			} else {
				var that = $(this).val();
				console.log(that);

				$.ajax({
			    	url: pubIP + 'storeRelationship/getCompanyType',
		            type: 'get',
		            headers: {
		                Accept: "application/json; charset=utf-8",
		                token: token
		            },
		            cache: false,
		            dataType: 'json',
		            data: {
		            	companyName: that
		            },
		            success: function (data) {
		                console.log(data);
		                if (data.code == 1) {
		                	if (data.data.companyType == 0) {
		                		window.parent.$('#addCustomerRelationship .qiye_type_input').val('厂家');  
		                	} else if (data.data.companyType == 1) {
		                		window.parent.$('#addCustomerRelationship .qiye_type_input').val('贸易商');
		                	} else if (data.data.companyType == 2) {
		                		window.parent.$('#addCustomerRelationship .qiye_type_input').val('终端');
		                	}
		                	       
		                	window.parent.$('#addCustomerRelationship .qiye_type_input').attr('data-selectIndex', data.data.companyType); 

		                	window.parent.$('#addCustomerRelationship .qiye_name_input').parent().find('.ts_div').text('').css('visibility', 'hidden');
		                } else {
		                	window.parent.$('.all_error_alert .innerErrmsg').text(data.msg);
		                	window.parent.$('.all_error_alert').show();
		                	window.parent.$('#addCustomerRelationship .qiye_name_input').val('');
		                	
		                }
		                
		            },
		            error: function (err) {
		                console.log(err);
		            }
			    });
				// $(this).parent().find('.ts_div').text('').css('visibility', 'hidden');
			}
		});


		//增加客户关系
		window.parent.$('.customer_relation_ship_btn').unbind();
		window.parent.$('.customer_relation_ship_btn').click(function() {

			var input = window.parent.$('#addCustomerRelationship .qiye_name_input');
			var qiye_type_input = window.parent.$('#addCustomerRelationship .qiye_type_input').attr('data-selectIndex');
			var up_down_relationship_input = window.parent.$('#addCustomerRelationship .up_down_relationship_input').attr('data-selectedindex');


			if (input.val() == '') {
				window.parent.$('#addCustomerRelationship .qiye_name_kuang .ts_div').text('企业名称不能为空').css('visibility', 'visible');
				return false;
			}

			if ($(this).attr('data-customerId') == '') {

				$.ajax({
			    	url: pubIP + 'storeRelationship/addStoreRelationship',
		            type: 'get',
		            headers: {
		                Accept: "application/json; charset=utf-8",
		                token: token
		            },
		            cache: false,
		            dataType: 'json',
		            data: {
		            	companyName: input.val(),
		            	storeType: qiye_type_input,
		            	relationship: up_down_relationship_input
		            },
		            success: function (data) {
		                console.log(data);
		                if (data.code == 1) {
		                	cf_alert(1, '添加成功');          
		                } else {
		                	window.parent.$('.all_error_alert .innerErrmsg').text(data.msg);
		                	window.parent.$('.all_error_alert').show();
		                }
		                
		            },
		            error: function (err) {
		                console.log(err);
		            }
			    });
			} else {

				$.ajax({
			    	url: pubIP + 'storeRelationship/updateStoreRelationship',
		            type: 'get',
		            headers: {
		                Accept: "application/json; charset=utf-8",
		                token: token
		            },
		            cache: false,
		            dataType: 'json',
		            data: {
		            	targetStoreId: $(this).attr('data-customerId'),
		            	storeType: qiye_type_input,
		            	relationship: up_down_relationship_input
		            },
		            success: function (data) {
		                console.log(data);
		                if (data.code == 1) {
		                	cf_alert(1, '修改成功');            
		                } else {
		                	window.parent.$('.all_error_alert .innerErrmsg').text(data.msg);
		                	window.parent.$('.all_error_alert').show();
		                }
		                
		            },
		            error: function (err) {
		                console.log(err);
		            }
			    });
			}
			

		});

		//删除客户关系
		$(document).on('click', '.del_btn', function() {

			window.parent.warn_alert($(this).attr('data-customerid'), '确定要删除吗？')
			
		});

		window.parent.$('.all_warn_alert .all_sure').unbind();
        window.parent.$('.all_warn_alert .all_sure').click(function() {
        	console.log($(this).attr('data-this'));
        	var that = $(this).attr('data-this');
        	$.ajax({
		    	url: pubIP + 'storeRelationship/deleteStoreRelationship',
	            type: 'get',
	            headers: {
	                Accept: "application/json; charset=utf-8",
	                token: token
	            },
	            cache: false,
	            dataType: 'json',
	            data: {
	            	targetStoreId: that
	            },
	            success: function (data) {
	                console.log(data);
	                if (data.code == 1) {
	                	window.parent.$('.all_success_alert .innerSuccmsg').text('删除成功');
                        window.parent.alert_show('.all_success_alert');
                        window.location.reload();          
	                } else {
	                	window.parent.$('.all_error_alert .innerErrmsg').text(data.msg);
	                	window.parent.$('.all_error_alert').show();
	                }
	                
	            },
	            error: function (err) {
	                console.log(err);
	            }
		    });

        });


		$('.search2').click(function() {
			isFirst = true;

			var strUp = $('.str_up').val();
			// var storeType = $('.store_type').val();
			var storeType = $('.store_type').attr('data-selectIndex');

			customerList(1, 9, strUp, storeType);
		});

		$('.selectPub ul li').click(function(){
		    event.stopPropagation();
		    $(this).parent().parent().attr('data-selectedindex', $(this).attr('data-index'));
		    $(this).parent().parent().find('span').text($(this).text());
		    if(adct1==0){
		        $(this).parent().parent().children('img').attr('src', './img/prl-select.jpg')
		    }else if(adct1==1){
		        $(this).parent().parent().children('img').attr('src', '../img/prl-select.jpg')
		    }else if(adct1==2){
		        $(this).parent().parent().children('img').attr('src', '../../img/prl-select.jpg')
		    }

		    $(this).parent().css('display','none');

		    isFirst = true;

			var strUp = $('.str_up').val();
			var storeType = $(this).attr('data-index');

			customerList(1, 9, strUp, storeType);

		});

		var isFirst = true;

		customerList(1, 9, '', '');

		// 客户关系列表
		function customerList(num, size, strUp, storeType) {
			$.ajax({
		    	url: pubIP + 'storeRelationship/getStoreRelationshipList',
	            type: 'get',
	            headers: {
	                Accept: "application/json; charset=utf-8",
	                token: token
	            },
	            cache: false,
	            data: {
	            	pageSize: size, //每页显示条数
	            	pageNum: num,
	            	strUp: strUp, //模糊搜索字段
	            	storeType: storeType //企业类型
	            },
	            dataType: 'json',
	            success: function (data) {
	                console.log(data);
	                if (data.code == 1) {
	                    
	                    if (data.data.result.length != 0) {

	                    	$('#page1').show();
		        			$('.pageJump').show();

		        			var str = '';
		        			for (var i = 0; i < data.data.result.length; i++) {
		        				
		        				data.data.result[i].addTime = new Date(data.data.result[i].addTime).Format("yyyy-MM-dd");

		        				if (data.data.result[i].storeType == 0) {
		        					var storeType2 = '厂家';
		        				} else if (data.data.result[i].storeType == 1) {
		        					var storeType2 = '贸易商';
		        				} else if (data.data.result[i].storeType == 2) {
		        					var storeType2 = '终端';
		        				}

		        				str += '<li>'
									+'<span class="person_num"><span>'+(i+1)+'</span></span>'
									+'<span class="qiye_name">'+data.data.result[i].companyName+'</span>'
									+'<span class="qiye_type" data-storeType="'+data.data.result[i].storeType+'">'+storeType2+'</span>'
									+'<span class="yewuyuan">'+data.data.result[i].userName+'</span>'
									+'<span class="add_time">'+data.data.result[i].addTime+'</span>'
									+'<span class="operate">'
										+'<a href="##" class="edit_btn" data-customerId="'+data.data.result[i].targetStoreId+'" data-relationship="'+data.data.result[i].relationship+'">编辑</a>'
										+'<a href="##" class="del_btn" data-customerId="'+data.data.result[i].targetStoreId+'">删除</a>'
									+'</span>'
								+'</li>'
		        			}

		        			$('.cont_list').html(str);

		        			if (isFirst) {
                            
	                            Page({
	                                num: data.data.pages,
	                                elem: $('#page1'),
	                                callback: function(n) {
	                                    customerList(n, size, strUp, storeType);
	                                }
	                            });

	                            $('.total').text(data.data.pages);


	                            isFirst = false;
	                       }

	                        $('.allPageN').text(num+'/'+data.data.pages);
	                    	
	                    } else {
		        			$('.cont_list').html('');
		        			$('#page1').hide();
		        			$('.pageJump').hide();
		        		}
	                    
	                }
	                
	            },
	            error: function (err) {
	                console.log(err);
	            }
		    });
		}


		//编辑客户关系
		$(document).on('click', '.edit_btn', function() {



			window.parent.$('#addCustomerRelationship .customer_relation_ship_btn').attr('data-customerId', $(this).attr('data-customerId'));
			
			window.parent.$('#addCustomerRelationship .modeltitle span').text('编辑客户关系');


			window.parent.$('#addCustomerRelationship .qiye_name_input').val($(this).parent().parent().find('.qiye_name').text());

			window.parent.$('#addCustomerRelationship .qiye_name_input').attr('disabled', true);

			window.parent.$('#addCustomerRelationship .qiye_name_kuang .ts_div').text('');

			//企业类型
			// window.parent.$('#addCustomerRelationship .qiye_type_input span').text($(this).parent().parent().find('.qiye_type').text());

			window.parent.$('#addCustomerRelationship .qiye_type_input').val($(this).parent().parent().find('.qiye_type').text());
			window.parent.$('#addCustomerRelationship .qiye_type_input').attr('data-selectIndex', $(this).parent().parent().find('.qiye_type').attr('data-storeType'));

			window.parent.$('#addCustomerRelationship .qiye_type_input').attr('disabled', true);

			var select_index = 0;

			if ($(this).parent().parent().find('.qiye_type').text() == '厂家') {
				select_index = 0;
			} else if ($(this).parent().parent().find('.qiye_type').text() == '贸易商') {
				select_index = 1;
			} else if ($(this).parent().parent().find('.qiye_type').text() == '终端') {
				select_index = 2;
			}

			window.parent.$('#addCustomerRelationship .qiye_type_input').attr('data-selectIndex', select_index);

			//上下游关系
			

			var relationship = '上游';

			if ($(this).attr('data-relationship') == 2) {
				relationship = '下游';
			} 

			window.parent.$('#addCustomerRelationship .up_down_relationship_input span').text(relationship);

			window.parent.$('#addCustomerRelationship .up_down_relationship_input').attr('data-selectedindex', $(this).attr('data-relationship'));
			
			window.parent.addCustomerRelationship();

		});

		

		window.parent.$('#addCustomerRelationship .selectPub').unbind();
	    window.parent.$('#addCustomerRelationship .selectPub').click(function(event){
			console.log($(this).attr("disabled"))
			if($(this).attr("disabled")=="disabled"){return;}//不可选
			if(adct1==1){
		        if($(this).children('img').attr('src') == '../img/prl-selected.jpg'){
		            $(this).children('img').attr('src', '../img/prl-select.jpg')
		        } else {
		            $(this).children('img').attr('src', '../img/prl-selected.jpg')
		        }

		        event.stopPropagation();

		        $(this).children('ul').toggle();
		        var that = $(this);
		        that.find('li').each(function(){
		            $(this).mouseover(function(){
		                $(this).addClass('hovered')
		            });
		            $(this).mouseleave(function(){
		                $(this).removeClass('hovered')
		            });
		            if($(this).attr('data-index') == that.attr('data-selectedindex')){
		                $(this).css({'background': '#6ea3ff','color': '#fff'});
		                $(this).siblings('li').css({'background': '#fff','color': '#999'});
		            }
		        });
			}else if(adct1==2){
		        if($(this).children('img').attr('src') == '../../img/prl-selected.jpg'){
		            $(this).children('img').attr('src', '../../img/prl-select.jpg')
		        } else {
		            $(this).children('img').attr('src', '../../img/prl-selected.jpg')
		        }

		        event.stopPropagation();

		        $(this).children('ul').toggle();
		        var that = $(this);
		        that.find('li').each(function(){
		            $(this).mouseover(function(){
		                $(this).addClass('hovered')
		            });
		            $(this).mouseleave(function(){
		                $(this).removeClass('hovered')
		            });
		            if($(this).attr('data-index') == that.attr('data-selectedindex')){
		                $(this).css({'background': '#6ea3ff','color': '#fff'});
		                $(this).siblings('li').css({'background': '#fff','color': '#999'});
		            }
		        });
			}else if(adct1==0){
		        if($(this).children('img').attr('src') == './img/prl-selected.jpg'){
		            $(this).children('img').attr('src', './img/prl-select.jpg')
		        } else {
		            $(this).children('img').attr('src', './img/prl-selected.jpg')
		        }

		        event.stopPropagation();

		        $(this).children('ul').toggle();
		        var that = $(this);
		        that.find('li').each(function(){
		            $(this).mouseover(function(){
		                $(this).addClass('hovered')
		            });
		            $(this).mouseleave(function(){
		                $(this).removeClass('hovered')
		            });
		            if($(this).attr('data-index') == that.attr('data-selectedindex')){
		                $(this).css({'background': '#6ea3ff','color': '#fff'});
		                $(this).siblings('li').css({'background': '#fff','color': '#999'});
		            }
		        });
			}


		}).mouseleave(function (event) {
		    if(adct1==0){
		        $(this).children('img').attr('src', './img/prl-select.jpg');
			}else if(adct1==1){
		        $(this).children('img').attr('src', '../img/prl-select.jpg');
			}else if(adct1==2){
		        $(this).children('img').attr('src', '../../img/prl-select.jpg');
		    }
		    $(this).children('ul').hide();
		});

		

	</script>
	<script type="text/javascript">

		var dom = document.getElementById("container");
		var myChart = echarts.init(dom);
		echartFun(myChart);
		// echartAjax(myChart);

		// function echartAjax(myChart) {
		// 	$.ajax({
		//     	url: pubIP + 'storeRelationship/getStoreRelationshipList',
	 //            type: 'get',
	 //            headers: {
	 //                Accept: "application/json; charset=utf-8",
	 //                token: token
	 //            },
	 //            cache: false,
	 //            data: {
	 //            	pageSize: 1000, //每页显示条数
	 //            	pageNum: 1
	 //            },
	 //            dataType: 'json',
	 //            success: function (data) {
	 //                console.log(data);
	 //                if (data.code == 1) {

	 //                	//创建一个数组，用来装对象传给series.data，因为series.data里面不能直接鞋for循环
  //               		var servicedata=[];
	                    
	 //                    if (data.data.result.length != 0) {

	 //                    	for(var i = 0; i < data.data.result.length; i++){
	 //                    		if (data.data.result[i].relationship == 1) {
	 //                    			data.data.result[i].relationship = '上游'
	 //                    		} else {
	 //                    			data.data.result[i].relationship = '下游'
	 //                    		}
		// 	                    var obj = new Object();
		// 	                    var obj2 = {};
		// 	                    var obj3 = {};
		// 	                    // obj.source = data.data.result[i].; 
		// 	                    obj.target = data.data.result[i].companyName;
		// 	                    obj.label = obj2;
		// 	                    obj2.normal = obj3;
		// 	                    obj3.show = true;
		// 	                    obj3.formatter = data.data.result[i].relationship;
		// 	                    obj3.fontSize = '12';
		// 	                    obj3.color = '#666';
		// 	                    servicedata[i]=obj;
		// 	                }

		// 	                console.log(servicedata);

		// 	                // myChart.setOption({            
		// 	                //     links:servicedata
		// 	                // });

	 //                    }
	 //                }
	 //            }
	 //        });
		// }

		function echartFun(myChart) {
			var servicedata=[];
	        var data_data = [];          	
			$.ajax({
		    	url: pubIP + 'storeRelationship/getStoreRelationshipList',
	            type: 'get',
	            headers: {
	                Accept: "application/json; charset=utf-8",
	                token: token
	            },
	            cache: false,
	            async:false, 
	            data: {
	            	pageSize: 1000, //每页显示条数
	            	pageNum: 1
	            },
	            dataType: 'json',
	            success: function (data) {
	                console.log(data);
	                if (data.code == 1) {

	                	//创建一个数组，用来装对象传给series.data，因为series.data里面不能直接鞋for循环
                		
	                    if (data.data.result.length != 0) {

	                    	for(var i = 0; i < data.data.result.length; i++){
	                    		if (data.data.result[i].relationship == 1) {
	                    			data.data.result[i].relationship = '上游'
	                    		} else {
	                    			data.data.result[i].relationship = '下游'
	                    		}

	                    		if (data.data.result[i].storeType == 0) {
		        					data.data.result[i].storeType = '厂家';
		        				} else if (data.data.result[i].storeType == 1) {
		        					data.data.result[i].storeType = '贸易商';
		        				} else if (data.data.result[i].storeType == 2) {
		        					data.data.result[i].storeType = '终端';
		        				}

			                    var obj = new Object();
			                    var obj2 = {};
			                    var obj3 = {};

			                    

			                    // obj.source = data.data.result[i].; 
			                    obj.target = data.data.result[i].companyName;
			                    obj.label = obj2;
			                    obj2.normal = obj3;
			                    obj3.show = true;
			                    obj3.formatter = data.data.result[i].relationship;
			                    obj3.fontSize = '12';
			                    obj3.color = '#666';
			                    servicedata[i]=obj;

			                    
			                    var dataObj = {};
					            var dataObj1 = {};


			                	dataObj.name = data.data.result[i].companyName;
			                	


			                	if (data.data.result[i].relationship == 1) {
			                		dataObj.x = 30+i;
			                		dataObj.y = 50+i;
			                	} else {               //需修改
			                		dataObj.x = 70+i;
			                		dataObj.y = 80+i;
			                	}

			                	if (data.data.result[i].store_image) {
			                		dataObj.symbol = 'image://' + data.data.result[i].store_image;
			                	} else {
			                		dataObj.symbol = 'image://../img/qiye_pic.png';
			                	}
			                	
			                	dataObj.symbolSize = [81,81];
			                	dataObj.flow = dataObj1;
			                	dataObj1.name = data.data.result[i].companyName;
			                	dataObj1.type = data.data.result[i].storeType;
			                	//缺少字段
			                	dataObj1.yujingzhi = data.data.result[i].warning_value;
			                	dataObj1.yingshou = data.data.result[i].shou;
			                	dataObj1.yingfu = data.data.result[i].fu;
			                	// dataObj1.yingName = data.data.result[i].companyName;

			                	// dataObj1.yingshou = '26236566.00';
			                	// dataObj1.yingfu = '26236566.00';
			                	// dataObj1.yingName = 'Website construction';
			                	data_data[i] = dataObj;
			                }

			                console.log(servicedata);

			                

			             //    {
				            //     name: '中泰化工',
				            //     x: 30,
				            //     y: 50,
				            //     symbol:'image://../img/qiye_pic.png',
				            //     symbolSize: [81,81],

				            //     flow: {name:'中泰化工', type: '终端企业', yujingzhi: '20万元', yingshou: '26236566.00', yingfu:'1234.00', yingName: 'Website construction'}
				            // }

	                    }

	                    if (data.date1) {
	                    	if (data.date1.storeType == 0) {
	        					data.date1.storeType = '厂家';
	        				} else if (data.date1.storeType == 1) {
	        					data.date1.storeType = '贸易商';
	        				} else if (data.date1.storeType == 2) {
	        					data.date1.storeType = '终端';
	        				}

	        				var oneself = {};
	        				var oneself2 = {};
	        				var oneself3 = {};

							oneself.target = data.date1.companyName;
		                    oneself.label = oneself2;
		                    oneself2.normal = oneself3;
		                    oneself3.show = true;
		                    // oneself3.formatter = data.date1.relationship;
		                    oneself3.fontSize = '12';
		                    oneself3.color = '#666';
		                    // servicedata[data.data.result.length]=obj;	
		                    console.log(oneself);
		                    servicedata.push(oneself);
		                    console.log(servicedata);


		                    var oneselfObj = {};
				            var oneselfObj1 = {};
				            var oneselfObj2 = {};
				            var oneselfObj3 = {};

		                	oneselfObj.name = data.date1.companyName;
		                	


		                	if (data.date1.relationship == 1) {
		                		oneselfObj.x = 30+i;
		                		oneselfObj.y = 50+i;
		                	} else {               //需修改
		                		oneselfObj.x = 70+i;
		                		oneselfObj.y = 80+i;
		                	}

		                	if (data.date1.store_image) {
		                		oneselfObj.symbol = 'image://' + data.date1.store_image;
		                	} else {
		                		oneselfObj.symbol = 'image://../img/qiye_pic.png';
		                	}
		                	
		                	oneselfObj.symbolSize = [81,81];
		                	oneselfObj.itemStyle = oneselfObj2;
		                	oneselfObj2.normal  = oneselfObj3;
		                	oneselfObj3.radius = '50%';
		                	// oneselfObj3.opacity= '0.5';
		                	oneselfObj.flow = oneselfObj1;
		                	oneselfObj1.name = data.date1.companyName;
		                	oneselfObj1.type = data.date1.storeType;
		                	//缺少字段
		                	oneselfObj1.flag = "1";
		                	oneselfObj1.yujingzhi = data.date1.warning_value;
		                	// oneselfObj1.yingshou = data.date1.companyName;
		                	// oneselfObj1.yingfu = data.date1.companyName;
		                	// oneselfObj1.yingName = data.date1.companyName;

		                	oneselfObj1.yingshou = '26236566.00';
		                	oneselfObj1.yingfu = '26236566.00';
		                	// oneselfObj1.yingName = 'Website construction';
		                	data_data.push(oneselfObj);
		                	console.log(oneselfObj);

	                    }

	                }
	            }
	        });

			// var dom = document.getElementById("container");
			// var myChart = echarts.init(dom);
			var app = {};
			option = null;
			option = {
			    tooltip: {
			    	trigger: 'item',
			    	backgroundColor: 'transparent',
	                formatter:function(params){
	                    if(params.data.flow){
	                    	var str = '';
	                    	if (params.data.flow.flag) {
	                    		str += '<div class="relationship_div" style="position:absolute;left:0px;top:-95px;">'
									+'<div class="padding_div">'
										+'<div class="qiye_name_bg">'+params.data.flow.name+'</div>'
										+'<div class="qiye_info">'
											+'<div class="qiye_leixing">企业类型：'+params.data.flow.type+'</div>'
											// +'<div class="yujingzhi">预警值：'+params.data.flow.yujingzhi+'</div>'
											// +'<div class="yingshoukuan">应收账款：<span>￥'+params.data.flow.yingshou+'</span></div>'
											// +'<div class="yingfukuan">应付账款：<span>￥'+params.data.flow.yingfu+'</span></div>'
										+'</div>'
									+'</div>'
								+'</div>';
	                    	} else {
	                    		str += '<div class="relationship_div" style="position:absolute;left:0px;top:-95px;">'
									+'<div class="padding_div">'
										+'<div class="qiye_name_bg">'+params.data.flow.name+'</div>'
										+'<div class="qiye_info">'
											+'<div class="qiye_leixing">企业类型：'+params.data.flow.type+'</div>'
											+'<div class="yujingzhi">预警值：'+params.data.flow.yujingzhi+'</div>'
											+'<div class="yingshoukuan">应收账款：<span>￥'+params.data.flow.yingshou+'</span></div>'
											+'<div class="yingfukuan">应付账款：<span>￥'+params.data.flow.yingfu+'</span></div>'
										+'</div>'
									+'</div>'
								+'</div>';
	                    	}
	                    	
	                        // return params.data.name + '到' + params.data.target + '的流量为'+ params.data.flow;
	                        return str;
	                    }
	                    else{
	                        return params.name;
	                    }
	                }
			    },
			    // emphasis: {
			    // 	color:
			    // },
			    animationDurationUpdate: 1500,
			    animationEasingUpdate: 'quinticInOut',
			    series : [
			        {
			            type: 'graph',
			            layout: 'none',
			            symbolSize: 50,
			            roam: true,
			            label: {
			                normal: {
			                    show: true,
			                    position: 'bottom',
			                    color: '#666',
			                    fontSize: 12,
			                    formatter: function(data) {
	                               	var result = "";
	                                // result += data.name + '\n' + data.data.flow.yingName;
	                                result += data.name;
	                                return result;
	                            },
			                },
			            },
			            edgeSymbol: ['circle', 'arrow'],
			            edgeSymbolSize: [4, 10],
			            edgeLabel: {
			                normal: {
			                    textStyle: {
			                        fontSize: 20
			                    }
			                },

			            },
			            data: data_data,
			            // data: [{
			            //     name: '中泰化工',
			            //     x: 30,
			            //     y: 50,
			            //     symbol:'image://../img/qiye_pic.png',
			            //     symbolSize: [81,81],

			            //     flow: {name:'中泰化工', type: '终端企业', yujingzhi: '20万元', yingshou: '26236566.00', yingfu:'1234.00', yingName: 'Website construction'}
			            // }, {
			            //     name: '中泰化工111',
			            //     x: 10,
			            //     y: 10,
			            //     symbol:'image://../img/qiye_pic.png',
			            //     symbolSize: [81,81],
			            //     flow: {name:'中泰化工111', type: '终端企业', yujingzhi: '20万元', yingshou: '26236566.00', yingfu:'26236566.00', yingName: 'Website construction'}
			            // }, {
			            //     name: '节点3',
			            //     x: 30,
			            //     y: 10,
			            //     symbol:'image://../img/qiye_pic.png',
			            //     symbolSize: [81,81],
			            //     flow: {name:'中泰化工222', type: '终端企业', yujingzhi: '20万元', yingshou: '26236566.00', yingfu:'26236566.00', yingName: 'Website construction'}
			            // }, {
			            //     name: '节点4',
			            //     x: 50,
			            //     y: 10,
			            //     symbol:'image://../img/qiye_pic.png',
			            //     symbolSize: [81,81],
			            //     flow: {name:'中泰化工', type: '终端企业', yujingzhi: '20万元', yingshou: '26236566.00', yingfu:'26236566.00', yingName: 'Website construction'}
			            // }, {
			            //     name: '节点5',
			            //     x: 70,
			            //     y: 80,
			            //     symbol:'image://../img/qiye_pic.png',
			            //     symbolSize: [81,81],
			            //     flow: {name:'中泰化工', type: '终端企业', yujingzhi: '20万元', yingshou: '26236566.00', yingfu:'26236566.00', yingName: 'Website construction'}
			            // }],
			            links: servicedata,
			            // links: [{
			            //     source: '中泰化工',
			            //     target: '节点3',
			            //     label: {
			            //     	normal: {
			            //     		show:true,
			            //     		formatter: '上游',
			            //     		fontSize: '12',
			            //     		color: '#666'
			            //     	}
			            //     }
			            // }, {
			            //     source: '中泰化工',
			            //     target: '中泰化工111',
			            //     label: {
			            //     	normal: {
			            //     		show:true,
			            //     		formatter: '上游',
			            //     		fontSize: '12',
			            //     		color: '#666'
			            //     	}
			            //     }
			            // }, {
			            //     source: '中泰化工',
			            //     target: '节点4',
			            //     label: {
			            //     	normal: {
			            //     		show:true,
			            //     		formatter: '上游',
			            //     		fontSize: '12',
			            //     		color: '#666'
			            //     	}
			            //     }
			            // }, {
			            //     source: '中泰化工',
			            //     target: '节点5',
			            //     label: {
			            //     	normal: {
			            //     		show:true,
			            //     		formatter: '下游',
			            //     		fontSize: '12',
			            //     		color: '#666'
			            //     	}
			            //     }
			            // }],
			            lineStyle: {
			                normal: {
			                    opacity: 0.9,
			                    width: 2,
			                    curveness: 0
			                }
			            }
			        }
			    ]
			};;



			
			if (option && typeof option === "object") {
			    myChart.setOption(option, true);
			}


		}
		
    </script>
</body>
</html>