<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" CONTENT="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="format-detection" content="telephone=no" />
	<title adct1="1">新疆化学品经营服务平台</title>
	<link rel="stylesheet" type="text/css" href="../css/index.css"/>
	<link rel="stylesheet" type="text/css" href="../css/home.css"/>
	<link rel="stylesheet" type="text/css" href="../css/common.css"/>
	<link rel="stylesheet" type="text/css" href="../css/activityCenter/activityCenter.css">
</head>
<body>

	<!-- 活动中心 -->
	<div class="activityCenter">
		<div class="activityCenterTitle">
			<span>活动列表</span>
		</div>
		<div class="sousuo_area">
			<div class="activity_name_sousuo">
				<span>活动标题：</span>
				<input type="text" name="" class="activity_name">
			</div>
			<div class="activity_name_sousuo" style="margin-left: 15px;">
				<span>报名情况：</span>
				<div class="selectPub activity_state" data-selectedindex="0">
			        <span></span>
			        <img src="../img/prl-select.jpg" alt="">
			        <ul>
			            <li data-index="1">未报名</li>
			            <li data-index="2">已报名</li>
			        </ul>
			    </div>
			</div>
			<div class="activity_name_sousuo" style="margin-left: 15px; margin-right: 23px;">
				<span>活动时间：</span>
				<!-- <input type="text" name="" class="activity_time"> -->
				<input type="text" class="date-input activity_time" id="test1">
			</div>
		</div>
		<ul class="clearfix activity_ul">
			<li class="one">活动类型</li>
			<li class="two">活动标题</li>
			<li class="three">活动开始结束时间</li>
			<li class="four">报名截止时间</li>
			<li class="five">状态</li>
		</ul>
		<ul class="activity_center" id="listInfo">
			<!-- <li>
				<span class="qiang_buy"><span>抢购</span></span>
				<span class="activity_title">XXXXXXX团购活动</span>
				<span class="activity_start_end_time">2017-10-02 12: 18: 20至2017-10-03 13: 20: 24</span>
				<span class="jiezhi_time">2017-09-31</span>
				<span class="status">报名中</span>
				<span class="baoming liji_baoming orange"><a href="##">立即报名</a></span>
				<span class="activity_detail"><a href="##">查看活动详情</a></span>
			</li>
			<li>
				<span class="qiang_buy"><span>抢购</span></span>
				<span class="activity_title">XXXXXXX团购活动</span>
				<span class="activity_start_end_time">2017-10-02 12: 18: 20至2017-10-03 13: 20: 24</span>
				<span class="jiezhi_time">2017-09-31</span>
				<span class="status">已报名，待商品添加</span>
				<span class="baoming blue yibaoming"><a href="activityList.html">添加活动商品</a></span>
				<span class="activity_detail"><a href="##">查看活动详情</a></span>
			</li>
			<li>
				<span class="qiang_buy"><span>抢购</span></span>
				<span class="activity_title">XXXXXXX团购活动</span>
				<span class="activity_start_end_time">2017-10-02 12: 18: 20至2017-10-03 13: 20: 24</span>
				<span class="jiezhi_time">2017-09-31</span>
				<span class="status">已报名，活动开始</span>
				<span class="baoming glay yibaoming"><a href="activityList.html">查看活动商品</a></span>
				<span class="activity_detail"><a href="##">查看活动详情</a></span>
			</li>
			<li>
				<span class="qiang_buy"><span>抢购</span></span>
				<span class="activity_title">XXXXXXX团购活动</span>
				<span class="activity_start_end_time">2017-10-02 12: 18: 20至2017-10-03 13: 20: 24</span>
				<span class="jiezhi_time">2017-09-31</span>
				<span class="status">已报名，活动结束</span>
				<span class="baoming glay yibaoming"><a href="activityList.html">查看活动商品</a></span>
				<span class="activity_detail"><a href="##">查看活动详情</a></span>
			</li>
			<li>
				<span class="qiang_buy"><span>抢购</span></span>
				<span class="activity_title">XXXXXXX团购活动</span>
				<span class="activity_start_end_time">2017-10-02 12: 18: 20至2017-10-03 13: 20: 24</span>
				<span class="jiezhi_time">2017-09-31</span>
				<span class="status">已结束</span>
				<span class="baoming"></span>
				<span class="activity_detail"><a href="##">查看活动详情</a></span>
			</li>
			<li>
				<span class="qiang_buy"><span>抢购</span></span>
				<span class="activity_title">XXXXXXX团购活动</span>
				<span class="activity_start_end_time">2017-10-02 12: 18: 20至2017-10-03 13: 20: 24</span>
				<span class="jiezhi_time">2017-09-31</span>
				<span class="status">正在进行</span>
				<span class="baoming"></span>
				<span class="activity_detail"><a href="##"><img src="../img/fangdajing.png">查看详情</a></span>
			</li> -->
		</ul>
	</div>
	<div class="mianCont pageCont" style="width:980px;text-align:center;overflow: hidden;height: auto;margin: 18px auto 6px;">
	        <ul class="pagination" id="page1"></ul>
	        <div class="pageJump">
	                    <span class="allPageN">1/200</span>
	                    <span class="total">共200页，</span>
	            <span>到第</span>
	            <input type="text" style="text-align: center; padding-left: 0px;"/>
	            <span>页</span>
	            <button type="button" class="button">GO</button>
	        </div>
	    </div>
	</div>
	<script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/template.js"></script>
	<script src="../js/pager.js" type="text/javascript" charset="utf-8"></script>
	<script src="../account/laydate/laydate.js"></script> <!-- 改成你的路径 -->

	<script type="text/html" id="listTpl">
		<%for(i in list){%>
		<li data-dbid="<%=list[i].dbid%>" data-startTime="<%=list[i].startTime%>" data-endTime="<%=list[i].endTime%>">
			<span class="qiang_buy">
				<%if (list[i].type == 1) {%>
				<span>抢购</span>
				<%} else if (list[i].type == 2) {%>
				<span>抢货</span>
				<%}%>
			</span>
			<span class="activity_title"><%=list[i].title%></span>
			<span class="activity_start_end_time"><%=list[i].startTime%>至<%=list[i].endTime%></span>
			<span class="jiezhi_time"><%=list[i].applyEndtime%></span>
			<%if (list[i].status == 1) {%> 
			<!-- 报名中 -->
			<span class="status">报名中</span>
			<span class="baoming liji_baoming orange"><a href="##">立即报名</a></span>
			<%} else if(list[i].status == 2){%>   
			<!-- 已报名，待添加商品< -->
			<span class="status">已报名,待添加商品</span>
			<span class="baoming blue yibaoming add_activity_shop"><a href="##">添加活动商品</a></span>
			<%} else if(list[i].status == 3) {%>
			<!-- 已报名，待活动开始 -->
			<span class="status">已报名，待活动开始</span>
			<span class="baoming glay yibaoming look_activity_shop"><a href="##">查看活动商品</a></span>
			<%} else if(list[i].status == 4) {%>
			<!-- 已报名，活动进行中 -->
			<span class="status">正在进行中</span>
			<span class="baoming"></span>
			<%} else if (list[i].status == 5){%>
			<!-- 已报名，活动已结束 -->
			<span class="status">已结束</span>
			<span class="baoming"></span>
			<%} else {%>
			<span class="status"></span>
			<span class="baoming"></span>
			<%}%>
			<span class="activity_detail"><a href="##">查看活动详情</a></span>
		</li>
		<%}%>
	</script>
	<script>

		$(document).on('click', '.look_activity_shop', function() {

			window.sessionStorage.setItem('activityId', $(this).parent().attr('data-dbid'));

			$(this).find('a').attr('href', 'activityList.html');

		});

		//点击添加活动商品
		$(document).on('click', '.add_activity_shop', function() {

			window.sessionStorage.setItem('activityId', $(this).parent().attr('data-dbid'));
			window.sessionStorage.setItem('activityTitle', $(this).parent().find('.activity_title').text());
			window.sessionStorage.setItem('startTime', $(this).parent().attr('data-startTime'));
			window.sessionStorage.setItem('endTime', $(this).parent().attr('data-endTime'));


			$(this).find('a').attr('href', 'activityList.html');

		});

		// 查看活动详情
		$(document).on('click', '.activity_detail', function() {
			var activityId = $(this).parent().attr('data-dbid');
			console.log(activityId);
			$.ajax({
				type: "get",
	            url: pubIP + "acticityApi/activityInfo",//v1.0
	            headers: {
	                token: token
	            },
	            cache: false,
	            async:false,
	            data: {
	            	activityId: activityId
	            },
	            dataType: "json",
	            success: function(json){
					console.log(json);

					$(window.parent.document).find('#activityDetail .title').html(json.data.title);
					$(window.parent.document).find('#activityDetail .activity_cont').html(json.data.content);
					$(window.parent.document).find('#activityDetail .baozhengjin').html(json.data.deposit);
					$(window.parent.document).find('#activityDetail .xianzhi').html(json.data.criteria);

					window.parent.activityDetail();
				},
				error: function(err) {
 					console.log(err);
				}
			});

		});


        $(document).on('click', '.liji_baoming', function() {
        	window.parent.lijiBaoming();
        });

        var isFirst = true;

        $('.activity_state span').text('已报名');

        activityCenter(1, '', '', '');

        $('.activity_state ul li').click(function(){
		    $('.activity_name').val('');
			$('.activity_time').val('');
			
		    activityCenter(1, $(this).attr('data-index'), '', '');
		});

		$(document).on('change', '.activity_name', function() {
			$('.activity_state span').text('');
			$('.activity_time').val('');
			
			activityCenter(1, '', $(this).val(), '');
		});

		laydate({
	        elem: '#test1',
	        format: 'YYYY-MM-DD',
	        istime: false,
	        choose: function(dates){ //选择好日期的回调
	            startTime = dates;
	            activityCenter(1, '', '', startTime);
	        }   
	    });



		// 活动列表
        function activityCenter(num, con, title, time) {
            $('.pagination').parent().hide();
            $("#listInfo").html("");
        	$.ajax({
	        	type: "post",
	            url: pubIP + "acticityApi/findActivityList",//v1.0
	            headers: {
	                token: token
	            },
	            cache: false,
	            async:false,
	            data: {
	            	companyId: companyId,
	            	pageNum: num,
	            	pageSize: 10,
	            	con: con,
	            	title: title,
	            	time: time
	            },
	            dataType: "json",
	            success: function(json){
					console.log(json);

					if(json.code == '0'){
	                    $('.pageJump').hide();
	                    $('.shop_list_table tbody').html('');
	                    $('.notMsg').show();
	                    return false;
	                }

	                if (json.data.length != 0) {

	                	for (var i = 0; i < json.data.length; i++) {
							json.data[i].applyStarttime = new Date(json.data[i].applyStarttime).Format("yyyy-MM-dd");
							json.data[i].applyEndtime = new Date(json.data[i].applyEndtime).Format("yyyy-MM-dd");
							json.data[i].endTime = new Date(json.data[i].endTime).Format("yyyy-MM-dd hh:mm:ss");
							json.data[i].startTime = new Date(json.data[i].startTime).Format("yyyy-MM-dd hh:mm:ss");
							
						}
						
						var result = template("listTpl",{list:json.data});
			            $('#listInfo').html(result);
	                    $('.pagination').parent().show();
			            

		                if (isFirst) {
		                        
		                    Page({
		                        num: json.count,
		                        elem: $('#page1'),
		                        callback: function(n) {
		                            console.log(n);
		                            activityCenter(n, con, title, time);
		                        }
		                    });
		                    
		                    $('.total').text('共'+json.count+'页，');


		                    isFirst = false;
		               }

		               $('.allPageN').text(num+'/'+json.count);
	                } else {
	                	$('.pageCont').hide();
	                }
					
					

	            },
	            error: function(err) {
	            	console.log(err);
	            }
	        });
        }


	</script>
</body>
</html>