<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" CONTENT="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="format-detection" content="telephone=no" />
	<title>新疆化学品经营服务平台</title>
	<link rel="stylesheet" type="text/css" href="../css/index.css"/>
	<link rel="stylesheet" type="text/css" href="../css/home.css"/>
	<link rel="stylesheet" type="text/css" href="../css/common.css"/>
	<link rel="stylesheet" type="text/css" href="../css/activityCenter/activityList.css">
</head>
<body>

	<!-- 活动商品列表 -->
	<div class="activityList">
		<div class="activityListTitle">
			<span>活动商品列表</span>
			<div class="fr mp">
				<span class="add_shop"><a href="##">添加商品</a></span>
			</div>
		</div>
		<div class="activityCenter">
			<ul class="clearfix activityCenterTitle">
				<li class="one"><input type="radio" name=""></li>
				<li class="two">排序</li>
				<li class="three">商品名称</li>
				<li class="four">价格</li>
				<li class="five">支付方式</li>
				<li class="six">纯度</li>
				<li class="seven">库存</li>
				<li class="eight">销量</li>
				<li class="nine">状态</li>
				<li class="ten">操作</li>
			</ul>
			<ul class="clearfix center_list" id="listInfo">
				<!-- <li>
					<span class="radio_input"><input type="radio" name="activitylist"></span>
					<span class="activity_shop_num">1</span>
					<span class="activity_shop_name">32斯维尔娃儿产品产品</span>
					<span class="activity_shop_price">100元/吨</span>
					<span class="pay_method orange">现汇，承兑，现汇+承兑</span>
					<span class="activity_shop_chundu">98%</span>
					<span class="activity_shop_kucun">100吨</span>
					<span class="activity_shop_xiaoliang">100吨</span>
					<span class="orange activity_shop_status">待审核</span>
					<span class="activity_shop_operate">
						<span class="blue">查看</span>
						<span class="operate_btn">取消</span>
					</span>
				</li>
				<li>
					<span class="radio_input"><input type="radio" name="activitylist"></span>
					<span class="activity_shop_num">1</span>
					<span class="activity_shop_name">32斯维尔娃儿产品产品</span>
					<span class="activity_shop_price">100元/吨</span>
					<span class="pay_method orange">现汇，承兑，现汇+承兑</span>
					<span class="activity_shop_chundu">98%</span>
					<span class="activity_shop_kucun">100吨</span>
					<span class="activity_shop_xiaoliang">100吨</span>
					<span class="orange activity_shop_status">已拒绝</span>
					<span class="activity_shop_operate">
						<span class="blue">查看</span>
						<span class="operate_btn">编辑</span>
					</span>
				</li>
				<li>
					<span class="radio_input"><input type="radio" name="activitylist"></span>
					<span class="activity_shop_num">1</span>
					<span class="activity_shop_name">32斯维尔娃儿产品产品</span>
					<span class="activity_shop_price">100元/吨</span>
					<span class="pay_method orange">现汇，承兑，现汇+承兑</span>
					<span class="activity_shop_chundu">98%</span>
					<span class="activity_shop_kucun">100吨</span>
					<span class="activity_shop_xiaoliang">100吨</span>
					<span class="orange activity_shop_status">已取消</span>
					<span class="activity_shop_operate">
						<span class="blue">查看</span>
						<span class="operate_btn">编辑</span>
					</span>
				</li>
				<li>
					<span class="radio_input"><input type="radio" name="activitylist"></span>
					<span class="activity_shop_num">1</span>
					<span class="activity_shop_name">32斯维尔娃儿产品产品</span>
					<span class="activity_shop_price">100元/吨</span>
					<span class="pay_method orange">现汇，承兑，现汇+承兑</span>
					<span class="activity_shop_chundu">98%</span>
					<span class="activity_shop_kucun">100吨</span>
					<span class="activity_shop_xiaoliang">100吨</span>
					<span class="orange activity_shop_status">待开始</span>
					<span class="activity_shop_operate">
						<span class="blue">查看</span>
						<span class="operate_btn">编辑</span>
					</span>
				</li>
				<li>
					<span class="radio_input"><input type="radio" name="activitylist"></span>
					<span class="activity_shop_num">1</span>
					<span class="activity_shop_name">32斯维尔娃儿产品产品</span>
					<span class="activity_shop_price">100元/吨</span>
					<span class="pay_method orange">现汇，承兑，现汇+承兑</span>
					<span class="activity_shop_chundu">98%</span>
					<span class="activity_shop_kucun">100吨</span>
					<span class="activity_shop_xiaoliang">100吨</span>
					<span class="orange activity_shop_status">进行中</span>
					<span class="activity_shop_operate">
						<span class="blue">查看</span>
						<span class="operate_btn">查看订单</span>
					</span>
				</li>
				<li>
					<span class="radio_input"><input type="radio" name="activitylist"></span>
					<span class="activity_shop_num">1</span>
					<span class="activity_shop_name">32斯维尔娃儿产品产品</span>
					<span class="activity_shop_price">100元/吨</span>
					<span class="pay_method orange">现汇，承兑，现汇+承兑</span>
					<span class="activity_shop_chundu">98%</span>
					<span class="activity_shop_kucun">100吨</span>
					<span class="activity_shop_xiaoliang">100吨</span>
					<span class="orange activity_shop_status">已结束</span>
					<span class="activity_shop_operate">
						<span class="blue">查看</span>
						<span class="operate_btn">查看订单</span>
					</span>
				</li> -->
			</ul>

			<div class="mianCont pageCont" style="width:980px;text-align:center;overflow: hidden;height: auto;margin: 10px auto 6px;">
		        <ul class="pagination" id="page1"></ul>
		        <div class="pageJump">
		                    <span class="allPageN">1/200</span>
		                    <span class="total">共200页，</span>
		            <span>到第</span>
		            <input type="text" style="text-align: center; padding-left: 0px;"/>
		            <span>页</span>
		            <button type="button" class="button">GO</button>
		        </div>
		    </div>
		</div>
	</div>
	<script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/common.js"></script>
	<script src="../js/pager.js" type="text/javascript" charset="utf-8"></script>
	<script src="../js/template.js"></script>
	<script type="text/html" id="listTpl">
		<%for (i in list) {%>
		<li data-productId="<%=list[i].productId%>">
			<span class="radio_input"><input type="radio" name="activitylist"></span>
			<span class="activity_shop_num"><%=i-0+1%></span>
			<span class="activity_shop_name"><%=list[i].productName%></span>
			<span class="activity_shop_price">
			<%if (list[i].productSpecUnit == 1) {%>
			<%=list[i].unitPrice%>克/桶
			<%} else if (list[i].productSpecUnit == 2){%>
			<%=list[i].unitPrice%>千克/袋
			<%} else if (list[i].productSpecUnit == 3) {%>
			<%=list[i].unitPrice%>千克/件
			<%}%>
			</span>
			<span class="pay_method orange">
			<%if (list[i].paymentMethod == 1) {%>
			现汇
			<%} else if(list[i].paymentMethod == 2) {%>
			承兑汇票
			<%} else if (list[i].paymentMethod == 3) {%>
			现汇+承兑
			<%} else if (list[i].paymentMethod == 0) {%>
			不限
			<%}%>
			</span>
			<span class="activity_shop_chundu"><%=list[i].productPurity%>%</span>
			<span class="activity_shop_kucun"><%=list[i].remain%>吨</span> <!-- 有问题============== -->
			<span class="activity_shop_xiaoliang">100吨</span><!-- 有问题============== -->
			<span class="orange activity_shop_status">
			<%if (list[i].status == 0){%>
			待审核
			<%} else if(list[i].status == 2) {%>
			已拒绝
			<%} else if(list[i].status == 3) {%>
			已取消
			<%} else if (list[i].status == 4) {%>
			待开始
			<%} else if(list[i].status == 5) {%>
			进行中
			<%} else if (list[i].status == 6) {%>
			已结束
			<%}%>
			</span>
			<span class="activity_shop_operate">
				<span class="blue look" data-productId="<%=list[i].productId%>" data-rate="<%=list[i].rate%>" data-activityId="<%=list[i].activityId%>" data-status="<%=list[i].status%>" data-supplyId="<%=list[i].supplyId%>" data-companyid="<%=list[i].company%>">查看</span>
				<%if (list[i].status == 0){%>
				<span class="operate_btn cancel"><a href="##" data-productId="<%=list[i].productId%>">取消</a></span>
				<%} else if(list[i].status == 2) {%>
				<span class="operate_btn edit"><a href="##" data-productId="<%=list[i].productId%>">编辑</a></span>
				<%} else if(list[i].status == 3) {%>
				<span class="operate_btn edit"><a href="##" data-productId="<%=list[i].productId%>">编辑</a></span>
				<%} else if (list[i].status == 4) {%>
				<span class="operate_btn edit"><a href="##" data-productId="<%=list[i].productId%>">编辑</a></span>
				<%} else if(list[i].status == 5) {%>
				<span class="operate_btn blue"><a href="../account/myPurchase-order.html">查看订单</a></span>
				<%} else if (list[i].status == 6) {%>
				<span class="operate_btn blue"><a href="../account/myPurchase-order.html">查看订单</a></span>
				<%}%>
				
			</span>
		</li>
		<%}%>
	</script>
	<script>
		
        var activityId = window.sessionStorage.getItem('activityId');

        var isFirst = true;

        activityList(1);

        //编辑
        $('.edit a').click(function() {
        	window.sessionStorage.setItem('productId', $(this).attr('data-productId'));
        	window.location.href = 'addActivityShop.html';
        });

        // 添加商品
        $('.add_shop a').click(function() {
        	window.sessionStorage.setItem('productId', '');
        	window.location.href = 'addActivityShop.html';
        });

        //查看
        $('.look').click(function() {
        	window.localStorage.setItem('objid', $(this).attr('data-supplyId'));
        	window.localStorage.setItem('activityId', $(this).attr('data-activityId'));
			window.localStorage.setItem('rate', $(this).attr('data-rate'));
			window.localStorage.setItem('status', $(this).attr('data-status'));

			window.localStorage.setItem('thisCompanyId', $(this).attr('data-companyid'));

			window.parent.location.href = '../flashSale/buyingDetails.html';
        });

        //取消
        $('.cancel a').click(function() {

        	window.parent.warn_alert($(this).attr('data-productId'), '确认要取消此商品吗？');
 
        });


        window.parent.$('.all_warn_alert .all_sure').unbind();
        window.parent.$('.all_warn_alert .all_sure').click(function() {
        	
        	var p_id = $(this).attr('data-this');

        	$.ajax({
	        	type: "get",
	            url: pubIP + "acticityApi/updateActivityProductById",//v1.0
	            headers: {
	                token: token
	            },
	            cache: false,
	            async:false,
	            data: {
	            	companyId: companyId,
	            	activityId: activityId,
	            	productId: p_id
	            },
	            dataType: "json",
	            success: function(data){
					console.log(data);

					if (data.code == 1) {
						window.location.reload();
					}

				},
	            error: function(err) {
	            	console.log(err);
	            }
	        });
        });

        // 活动商品列表
        function activityList(num){
        	$.ajax({
	        	type: "get",
	            url: pubIP + "acticityApi/findActivityGoodsCompany",//v1.0
	            headers: {
	                token: token
	            },
	            cache: false,
	            async:false,
	            data: {
	            	companyId: companyId,
	            	activityId: activityId,
	            	pageNum: num,
	            	pageSize: 10
	            },
	            dataType: "json",
	            success: function(data){
					console.log(data);

					if (data.data.result.length != 0) {

		            	var payMethodStr = '';
		            	var str = '';
		            	for (var i = 0; i < data.data.result.length; i++) {
		            		payMethodStr = String(data.data.result[i].paymentMethod).split('');
		            		console.log(payMethodStr);

		            		var payStr = '';

		            		for (j in payMethodStr) {

			        		
				        		if (payMethodStr[j] == '1') {
									payStr += '现汇 '
				        		}

				        		if (payMethodStr[j] == '2') {
									payStr += '承兑 '
				        		}

				        		if (payMethodStr[j] == '3') {
									payStr += '现汇+承兑'
				        		}
				        		
				        	}


				        	str += '<li data-productId="'+data.data.result[i].productId+'">'
								+'<span class="radio_input"><input type="radio" name="activitylist"></span>'
								+'<span class="activity_shop_num">'+(i+1)+'</span>'
								+'<span class="activity_shop_name">'+data.data.result[i].productName+'</span>'
								+'<span class="activity_shop_price">'
								if (data.data.result[i].productSpecUnit == 1) {
									str += data.data.result[i].unitPrice+'克/桶'
								} else if (data.data.result[i].productSpecUnit == 2) {
									str += data.data.result[i].unitPrice+'千克/袋'
								} else if (data.data.result[i].productSpecUnit == 3) {
									str += data.data.result[i].unitPrice+'千克/件'
								}
								
								str += '</span>'
								+'<span class="pay_method orange">'+payStr+'</span>'
								+'<span class="activity_shop_chundu">'+data.data.result[i].productPurity+'%</span>'
								+'<span class="activity_shop_kucun">'+data.data.result[i].remain+'吨</span>'
								+'<span class="activity_shop_xiaoliang">100吨</span>'
								+'<span class="orange activity_shop_status">'

								if (data.data.result[i].status == 0){
									str += '待审核'
								} else if(data.data.result[i].status == 2) {
									str += '已拒绝'
								} else if(data.data.result[i].status == 3) {
									str += '已取消'
								} else if (data.data.result[i].status == 4) {
									str += '待开始'
								} else if(data.data.result[i].status == 5) {
									str += '进行中'
								} else if (data.data.result[i].status == 6) {
									str += '已结束'
								}
								str += '</span>'
								+'<span class="activity_shop_operate">'
									+'<span class="blue look" data-productId="'+data.data.result[i].productId+'" data-rate="'+data.data.result[i].rate+'" data-activityId="'+data.data.result[i].activityId+'" data-status="'+data.data.result[i].status+'" data-supplyId="'+data.data.result[i].supplyId+'" data-companyid="'+data.data.result[i].company+'">查看</span>'

									if (data.data.result[i].status == 0){
										str += '<span class="operate_btn cancel"><a href="##" data-productId="'+data.data.result[i].productId+'">取消</a></span>'
									} else if(data.data.result[i].status == 2) {
										str += '<span class="operate_btn edit"><a href="##" data-productId="'+data.data.result[i].productId+'">编辑</a></span>'
									} else if(data.data.result[i].status == 3) {
										str += '<span class="operate_btn edit"><a href="##" data-productId="'+data.data.result[i].productId+'">编辑</a></span>'
									} else if (data.data.result[i].status == 4) {
										str += '<span class="operate_btn edit"><a href="##" data-productId="'+data.data.result[i].productId+'">编辑</a></span>'
									} else if(data.data.result[i].status == 5) {
										str += '<span class="operate_btn blue"><a href="../account/myPurchase-order.html">查看订单</a></span>'
									} else if (data.data.result[i].status == 6) {
										str += '<span class="operate_btn blue"><a href="../account/myPurchase-order.html">查看订单</a></span>'
									}
									
								str += '</span>'
							+'</li>'

				        }
			        	
			        }

					
					// var result = template("listTpl",{list:data.data.result});
			  //       $('#listInfo').html(result);

			        $('#listInfo').html(str);

			        if(data.data.code == '0'){
	                    $('.pageCont').hide();
	                    $('.center_list').html('');
	                    $('.notMsg').show();
	                    return false;
	                }

		            if (data.data.result.length != 0) {

		            	if (isFirst) {
		                        
		                    Page({
		                        num: data.data.pages,
		                        elem: $('#page1'),
		                        callback: function(n) {
		                            console.log(n);
		                            activityList(n);
		                        }
		                    });
		                    
		                    $('.total').text('共'+data.data.pages+'页，');


		                    isFirst = false;
		               }

		               $('.allPageN').text(num+'/'+data.data.pages);
		           	} else {
		           		$('.pageCont').hide();
		           		$('.center_list').html('');
		           	}

	            },
	            error: function(err) {
	            	console.log(err);
	            }
	        });
        }


	</script>
</body>
</html>